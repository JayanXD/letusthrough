<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaf It Up! - Plant Tracking Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0a3d2e 0%, #1a5c4a 50%, #0d2f26 100%);
            color: #c5f5d7;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            transition: background 0.5s ease;
        }

        body.day-mode {
            background: linear-gradient(135deg, #87CEEB 0%, #6CB4E8 50%, #4A90E2 100%);
        }

        body.rainy-mode {
            background: linear-gradient(135deg, #4A5568 0%, #2D3748 50%, #1A202C 100%);
        }

        body.day-mode .header,
        body.day-mode .sidebar,
        body.day-mode .feature-card,
        body.day-mode .modal-content,
        body.day-mode .plant-card,
        body.day-mode .tip-card,
        body.day-mode .mission-card,
        body.day-mode .announcement-board {
            background: rgba(255, 255, 255, 0.2);
        }

        body.day-mode .logo,
        body.day-mode .menu-item,
        body.day-mode h2,
        body.day-mode h3,
        body.day-mode .profile-name {
            color: #2d5a3d;
            text-shadow: 0 0 10px rgba(45, 90, 61, 0.3);
        }

        body.day-mode p,
        body.day-mode .plant-info {
            color: #1a5c4a;
        }

        body.rainy-mode .floating-particle {
            background: rgba(100, 150, 200, 0.4);
        }

        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            pointer-events: none;
        }

        .floating-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: rgba(110, 255, 180, 0.3);
            border-radius: 50%;
            animation: float 15s infinite ease-in-out;
            transition: background 0.5s ease;
        }

        .floating-particle:nth-child(1) { left: 10%; top: 20%; animation-delay: 0s; }
        .floating-particle:nth-child(2) { left: 80%; top: 40%; animation-delay: 2s; }
        .floating-particle:nth-child(3) { left: 50%; top: 60%; animation-delay: 4s; }
        .floating-particle:nth-child(4) { left: 20%; top: 80%; animation-delay: 6s; }
        .floating-particle:nth-child(5) { left: 70%; top: 10%; animation-delay: 8s; }

        .raindrop {
            position: absolute;
            width: 2px;
            height: 20px;
            background: linear-gradient(to bottom, transparent, rgba(174, 214, 241, 0.6));
            animation: fall 1.5s linear infinite;
            opacity: 0;
        }

        body.rainy-mode .raindrop {
            opacity: 1;
        }

        .raindrop:nth-child(6) { left: 10%; animation-delay: 0s; }
        .raindrop:nth-child(7) { left: 25%; animation-delay: 0.3s; }
        .raindrop:nth-child(8) { left: 40%; animation-delay: 0.6s; }
        .raindrop:nth-child(9) { left: 55%; animation-delay: 0.2s; }
        .raindrop:nth-child(10) { left: 70%; animation-delay: 0.5s; }
        .raindrop:nth-child(11) { left: 85%; animation-delay: 0.8s; }
        .raindrop:nth-child(12) { left: 15%; animation-delay: 0.4s; }
        .raindrop:nth-child(13) { left: 60%; animation-delay: 0.1s; }

        @keyframes fall {
            0% { top: -20px; }
            100% { top: 100%; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-30px) translateX(20px); }
            50% { transform: translateY(-60px) translateX(-10px); }
            75% { transform: translateY(-30px) translateX(-20px); }
        }

        .container {
            position: relative;
            z-index: 1;
            display: flex;
            min-height: 100vh;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(10, 50, 40, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 100;
            transition: background 0.5s ease;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: bold;
            color: #6effb4;
            text-shadow: 0 0 20px rgba(110, 255, 180, 0.6);
            transition: color 0.5s ease;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #6effb4, #4dcc8f);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 0 20px rgba(110, 255, 180, 0.4);
        }

        .header-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .header-profile:hover {
            transform: scale(1.05);
        }

        .mini-avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.4);
            overflow: hidden;
        }

        .mini-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-name {
            color: #6effb4;
            font-size: 16px;
            font-weight: bold;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .points-mini {
            background: rgba(110, 255, 180, 0.1);
            padding: 8px 20px;
            border-radius: 20px;
            border: 2px solid rgba(110, 255, 180, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .points-mini span {
            color: #ffd700;
            font-size: 18px;
            font-weight: bold;
        }

        .level-badge {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #0a3d2e;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .level-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.7);
        }

        .weather-toggle {
            background: rgba(110, 255, 180, 0.2);
            border: 2px solid rgba(110, 255, 180, 0.4);
            color: #6effb4;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .weather-toggle:hover {
            background: rgba(110, 255, 180, 0.3);
            box-shadow: 0 0 20px rgba(110, 255, 180, 0.4);
        }

        .notif-btn {
            background: rgba(110, 255, 180, 0.2);
            border: 2px solid rgba(110, 255, 180, 0.4);
            color: #6effb4;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            position: relative;
        }

        .notif-btn:hover {
            background: rgba(110, 255, 180, 0.3);
            box-shadow: 0 0 20px rgba(110, 255, 180, 0.4);
        }

        .notif-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(255, 107, 107, 0.5);
        }

        .settings-btn {
            background: rgba(110, 255, 180, 0.2);
            border: 2px solid rgba(110, 255, 180, 0.4);
            color: #6effb4;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            background: rgba(110, 255, 180, 0.3);
            box-shadow: 0 0 20px rgba(110, 255, 180, 0.4);
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 70px;
            width: 200px;
            height: calc(100vh - 70px);
            background: rgba(15, 60, 50, 0.8);
            backdrop-filter: blur(10px);
            padding: 30px 0;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
            transition: background 0.5s ease;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 30px;
            color: #c5f5d7;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 16px;
            cursor: pointer;
        }

        .menu-item:hover {
            background: rgba(110, 255, 180, 0.1);
            border-left: 4px solid #6effb4;
            color: #6effb4;
            text-shadow: 0 0 10px rgba(110, 255, 180, 0.5);
        }

        .menu-item.active {
            background: rgba(110, 255, 180, 0.15);
            border-left: 4px solid #6effb4;
            color: #6effb4;
        }

        .main-content {
            margin-left: 200px;
            margin-top: 70px;
            padding: 40px;
            width: calc(100% - 200px);
        }

        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        .greeting-section {
            background: rgba(20, 70, 60, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid rgba(110, 255, 180, 0.3);
            text-align: center;
        }

        .greeting-section h1 {
            color: #6effb4;
            font-size: 36px;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(110, 255, 180, 0.4);
        }

        .greeting-section p {
            color: #a8e6cf;
            font-size: 16px;
        }

        .greeting-section p a {
            color: #6effb4;
            text-decoration: underline;
            cursor: pointer;
        }

        .greeting-section p a:hover {
            color: #4dcc8f;
        }

        .announcement-board {
            background: rgba(20, 70, 60, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid rgba(255, 215, 0, 0.4);
            transition: background 0.5s ease;
        }

        .announcement-board h2 {
            color: #ffd700;
            font-size: 28px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .announcements-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .announcement-item {
            background: rgba(255, 215, 0, 0.1);
            border-left: 4px solid #ffd700;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .announcement-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
        }

        .announcement-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .announcement-title {
            color: #ffd700;
            font-size: 18px;
            font-weight: bold;
        }

        .announcement-date {
            color: #a8e6cf;
            font-size: 12px;
            font-style: italic;
        }

        .announcement-content {
            color: #c5f5d7;
            line-height: 1.6;
            font-size: 15px;
        }

        .announcement-type {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 10px;
        }

        .announcement-type.news {
            background: rgba(110, 255, 180, 0.2);
            color: #6effb4;
            border: 1px solid rgba(110, 255, 180, 0.4);
        }

        .announcement-type.event {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            border: 1px solid rgba(255, 107, 107, 0.4);
        }

        .announcement-type.update {
            background: rgba(139, 92, 246, 0.2);
            color: #a78bfa;
            border: 1px solid rgba(139, 92, 246, 0.4);
        }

        .no-announcements {
            text-align: center;
            padding: 40px 20px;
            color: #a8e6cf;
        }

        .no-announcements-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .points-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.5);
            z-index: 3000;
            background: linear-gradient(135deg, rgba(110, 255, 180, 0.95), rgba(77, 204, 143, 0.95));
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 40px 60px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(110, 255, 180, 0.6), 0 0 100px rgba(110, 255, 180, 0.4);
            border: 4px solid #6effb4;
            min-width: 400px;
            animation: popupAppear 0.3s ease forwards;
        }

        .points-popup.active {
            display: block;
        }

        @keyframes popupAppear {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        @keyframes popupDisappear {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
        }

        .points-popup.closing {
            animation: popupDisappear 0.3s ease forwards;
        }

        .points-popup-icon {
            font-size: 80px;
            margin-bottom: 15px;
            animation: bounce 0.6s infinite;
        }

        .points-popup-text {
            font-size: 32px;
            font-weight: bold;
            color: #0a3d2e;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .points-popup-amount {
            font-size: 48px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
        }

        .info-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.5);
            z-index: 3000;
            background: linear-gradient(135deg, rgba(255, 152, 102, 0.95), rgba(255, 179, 153, 0.95));
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 40px 50px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(255, 152, 102, 0.6), 0 0 100px rgba(255, 152, 102, 0.4);
            border: 4px solid #ff9866;
            max-width: 500px;
            animation: popupAppear 0.3s ease forwards;
        }

        .info-popup.active {
            display: block;
        }

        .info-popup.closing {
            animation: popupDisappear 0.3s ease forwards;
        }

        .info-popup-icon {
            font-size: 70px;
            margin-bottom: 15px;
        }

        .info-popup-title {
            font-size: 28px;
            font-weight: bold;
            color: #4a2c1a;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .info-popup-message {
            font-size: 16px;
            color: #6d4c3d;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .info-popup-close {
            padding: 12px 30px;
            background: #4a2c1a;
            color: #ff9866;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .info-popup-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .update-picture-btn {
            width: 100%;
            padding: 10px;
            background: rgba(139, 92, 246, 0.2);
            border: 2px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: #a78bfa;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
        }

        .update-picture-btn:hover {
            background: rgba(139, 92, 246, 0.3);
            border-color: #a78bfa;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.4);
        }

        .log-plant-btn-top {
            width: 100%;
            max-width: 300px;
            padding: 15px;
            background: linear-gradient(135deg, #6effb4, #4dcc8f);
            border: none;
            border-radius: 10px;
            color: #0a3d2e;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(110, 255, 180, 0.4);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .log-plant-btn-top:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(110, 255, 180, 0.6);
        }

        .daily-missions-section {
            background: rgba(20, 70, 60, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid rgba(110, 255, 180, 0.3);
        }

        .daily-missions-section h2 {
            color: #6effb4;
            font-size: 28px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .missions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .mission-card {
            background: rgba(20, 70, 60, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(110, 255, 180, 0.2);
            transition: all 0.3s ease;
        }

        .mission-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(110, 255, 180, 0.3);
            border-color: #6effb4;
        }

        .mission-card.completed {
            opacity: 0.6;
            border-color: rgba(110, 255, 180, 0.5);
        }

        .mission-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .mission-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, rgba(110, 255, 180, 0.2), rgba(77, 204, 143, 0.2));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 2px solid rgba(110, 255, 180, 0.3);
        }

        .mission-info {
            flex: 1;
        }

        .mission-title {
            color: #6effb4;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .mission-points {
            color: #ffd700;
            font-size: 14px;
            font-weight: bold;
        }

        .mission-description {
            color: #a8e6cf;
            font-size: 13px;
            line-height: 1.4;
            margin-bottom: 15px;
        }

        .mission-btn {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #6effb4, #4dcc8f);
            border: none;
            border-radius: 10px;
            color: #0a3d2e;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mission-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(110, 255, 180, 0.5);
        }

        .mission-btn:disabled {
            background: rgba(100, 100, 100, 0.5);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .mission-timer {
            text-align: center;
            padding: 10px;
            background: rgba(110, 255, 180, 0.1);
            border-radius: 10px;
            margin-top: 20px;
            border: 2px solid rgba(110, 255, 180, 0.2);
        }

        .mission-timer-text {
            color: #6effb4;
            font-size: 14px;
            font-weight: bold;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .feature-card {
            background: rgba(20, 70, 60, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            transition: all 0.4s ease;
            cursor: pointer;
            border: 2px solid rgba(110, 255, 180, 0.2);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 50px rgba(110, 255, 180, 0.3), 0 0 50px rgba(110, 255, 180, 0.2);
            border-color: #6effb4;
        }

        .card-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #6effb4, #4dcc8f);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 36px;
            box-shadow: 0 0 30px rgba(110, 255, 180, 0.4);
            transition: all 0.3s ease;
        }

        .feature-card:hover .card-icon {
            box-shadow: 0 0 50px rgba(110, 255, 180, 0.6);
            transform: scale(1.1);
        }

        .feature-card h3 {
            color: #6effb4;
            font-size: 24px;
            margin-bottom: 15px;
            text-shadow: 0 0 15px rgba(110, 255, 180, 0.3);
}

        .feature-card p {
            color: #a8e6cf;
            font-size: 14px;
            line-height: 1.6;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(20, 70, 60, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(110, 255, 180, 0.3);
            transition: background 0.5s ease;
            margin: 20px 0;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-header h2 {
            color: #6effb4;
            font-size: 28px;
        }

        .close-btn {
            background: none;
            border: none;
            color: #6effb4;
            font-size: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            transform: scale(1.2);
            text-shadow: 0 0 15px rgba(110, 255, 180, 0.6);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #a8e6cf;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 2px solid rgba(110, 255, 180, 0.3);
            background: rgba(10, 50, 40, 0.5);
            color: #c5f5d7;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input[type="file"] {
            padding: 10px;
            cursor: pointer;
        }

        .form-group select {
            cursor: pointer;
        }

        #imagePreview img, #profileImagePreview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 10px;
            border: 2px solid rgba(110, 255, 180, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .plant-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid rgba(110, 255, 180, 0.2);
        }

        .no-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, rgba(110, 255, 180, 0.1), rgba(77, 204, 143, 0.1));
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            border: 2px dashed rgba(110, 255, 180, 0.3);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #6effb4;
            box-shadow: 0 0 15px rgba(110, 255, 180, 0.3);
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #6effb4, #4dcc8f);
            border: none;
            border-radius: 10px;
            color: #0a3d2e;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(110, 255, 180, 0.4);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(110, 255, 180, 0.6);
        }

        #map {
            width: 100%;
            height: 400px;
            border-radius: 10px;
            border: 2px solid rgba(110, 255, 180, 0.3);
            z-index: 1;
        }

        #communityMap {
            width: 100%;
            height: 500px;
            border-radius: 10px;
            border: 2px solid rgba(110, 255, 180, 0.3);
        }

        .leaflet-popup-content-wrapper {
            background: rgba(20, 70, 60, 0.95);
            color: #c5f5d7;
        }

        .leaflet-popup-tip {
            background: rgba(20, 70, 60, 0.95);
        }

        .popup-plant-image {
            width: 100%;
            max-width: 200px;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .popup-content h4 {
            color: #6effb4;
            margin-bottom: 8px;
        }

        .popup-content p {
            color: #a8e6cf;
            font-size: 13px;
            margin: 4px 0;
        }

        .plants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .plant-card {
            background: rgba(20, 70, 60, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(110, 255, 180, 0.2);
            transition: all 0.4s ease;
            cursor: pointer;
            position: relative;
        }

        .plant-card.expanded {
            transform: scale(1.15);
            z-index: 500;
            box-shadow: 0 20px 60px rgba(110, 255, 180, 0.6);
            border-color: #6effb4;
        }

        .plant-card:hover:not(.expanded) {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(110, 255, 180, 0.4);
            border-color: #6effb4;
        }

        .plant-card h3 {
            color: #6effb4;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .plant-info {
            color: #a8e6cf;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .plant-age {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid rgba(255, 215, 0, 0.4);
            padding: 10px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }

        .plant-age-text {
            color: #ffd700;
            font-size: 16px;
            font-weight: bold;
        }

        .plant-progress {
            margin: 15px 0;
        }

        .progress-label {
            color: #6effb4;
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .progress-bar-container {
            background: rgba(10, 50, 40, 0.5);
            height: 25px;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid rgba(110, 255, 180, 0.3);
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #6effb4, #4dcc8f);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0a3d2e;
            font-weight: bold;
            font-size: 12px;
            transition: width 0.5s ease;
        }

        .plant-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

       .water-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #6effb4, #4dcc8f);
            border: none;
            border-radius: 10px;
            color: #0a3d2e;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .water-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(110, 255, 180, 0.5);
        }

        .water-btn:disabled {
            background: rgba(100, 100, 100, 0.5);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .last-watered {
            color: #a8e6cf;
            font-size: 12px;
            text-align: center;
            margin-top: 8px;
            font-style: italic;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #a8e6cf;
            grid-column: 1 / -1;
        }

        .empty-state-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .tips-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 30px;
        }

        .tip-card {
            background: rgba(20, 70, 60, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border-left: 4px solid #6effb4;
            transition: all 0.3s ease;
        }

        .tip-card:hover {
            transform: translateX(10px);
            box-shadow: 0 10px 30px rgba(110, 255, 180, 0.3);
        }

        .tip-card h3 {
            color: #6effb4;
            font-size: 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tip-card p {
            color: #a8e6cf;
            line-height: 1.6;
        }

        .podium-container {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 20px;
            margin-bottom: 50px;
            padding: 0 20px;
        }

        .podium-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .podium-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            margin-bottom: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .podium-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .podium-avatar.green {
            background: linear-gradient(135deg, #7ed957, #5fb83d);
        }

        .podium-avatar.purple {
            background: linear-gradient(135deg, #a78bfa, #8b5cf6);
        }

        .podium-avatar.olive {
            background: linear-gradient(135deg, #9ca86f, #7a8556);
        }

        .first-place .podium-avatar {
            width: 120px;
            height: 120px;
            font-size: 60px;
        }

        .podium-rank {
            font-size: 18px;
            font-weight: bold;
            color: #6effb4;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .first-place .podium-rank {
            font-size: 24px;
        }

        .podium-name {
            font-size: 16px;
            font-weight: bold;
            color: #c5f5d7;
            margin-bottom: 5px;
        }

        .podium-points {
            font-size: 14px;
            color: #a8e6cf;
        }

        .podium-item:hover .podium-avatar {
            transform: scale(1.1);
            box-shadow: 0 12px 40px rgba(110, 255, 180, 0.4);
        }

        .rankings-list {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .rank-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 30px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .rank-row:hover {
            transform: translateX(10px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }

        .rank-row.lime {
            background: rgba(156, 204, 101, 0.3);
        }

        .rank-row.orange {
            background: rgba(255, 152, 102, 0.3);
        }

        .rank-row.peach {
            background: rgba(255, 179, 153, 0.3);
        }

        body.day-mode .rank-row.lime {
            background: rgba(156, 204, 101, 0.5);
        }

        body.day-mode .rank-row.orange {
            background: rgba(255, 152, 102, 0.5);
        }

        body.day-mode .rank-row.peach {
            background: rgba(255, 179, 153, 0.5);
        }

        .rank-position {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
            min-width: 60px;
        }

        .rank-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .rank-avatar.small {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #6effb4, #4dcc8f);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .rank-avatar.small img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .rank-name {
            font-size: 16px;
            font-weight: bold;
            color: #2d3748;
        }

        .rank-points {
            font-size: 16px;
            font-weight: bold;
            color: #2d3748;
            min-width: 100px;
            text-align: right;
        }

        body.day-mode .rank-position,
        body.day-mode .rank-name,
        body.day-mode .rank-points {
            color: #1a202c;
        }

        .rewards-header {
            background: rgba(20, 70, 60, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            text-align: center;
            border: 2px solid rgba(110, 255, 180, 0.3);
        }

        .rewards-points {
            font-size: 48px;
            color: #ffd700;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            margin: 10px 0;
        }

        .rewards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }

        .reward-item {
            background: rgba(20, 70, 60, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid rgba(110, 255, 180, 0.2);
            transition: all 0.3s ease;
            text-align: center;
        }

        .reward-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(110, 255, 180, 0.3);
            border-color: #6effb4;
        }

        .reward-image {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, rgba(110, 255, 180, 0.2), rgba(77, 204, 143, 0.2));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            margin: 0 auto 15px;
            border: 2px solid rgba(110, 255, 180, 0.3);
        }

        .reward-name {
            color: #6effb4;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .reward-price {
            color: #ffd700;
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }

        .redeem-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #6effb4, #4dcc8f);
            border: none;
            border-radius: 10px;
            color: #0a3d2e;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .redeem-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(110, 255, 180, 0.5);
        }

        .redeem-btn:disabled {
            background: rgba(100, 100, 100, 0.5);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .history-section {
            margin-top: 50px;
        }

        .history-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .history-tab {
            padding: 12px 25px;
            background: rgba(20, 70, 60, 0.6);
            border: 2px solid rgba(110, 255, 180, 0.2);
            border-radius: 10px;
            color: #a8e6cf;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .history-tab.active {
            background: rgba(110, 255, 180, 0.2);
            border-color: #6effb4;
            color: #6effb4;
        }

        .history-tab:hover {
            background: rgba(110, 255, 180, 0.15);
            border-color: #6effb4;
        }

        .history-content {
            display: none;
        }

        .history-content.active {
            display: block;
        }

        .history-item {
            background: rgba(20, 70, 60, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid rgba(110, 255, 180, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .history-item.pending {
            border-color: rgba(255, 215, 0, 0.4);
        }

        .history-item.approved {
            border-color: rgba(110, 255, 180, 0.4);
        }

        .history-info {
            flex: 1;
        }

        .history-item-name {
            color: #6effb4;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .history-item-details {
            color: #a8e6cf;
            font-size: 14px;
        }

        .history-status {
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }

        .history-status.pending {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            border: 2px solid rgba(255, 215, 0, 0.4);
        }

        .history-status.approved {
            background: rgba(110, 255, 180, 0.2);
            color: #6effb4;
            border: 2px solid rgba(110, 255, 180, 0.4);
        }

        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .task-card {
            background: rgba(20, 70, 60, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(110, 255, 180, 0.2);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(110, 255, 180, 0.3);
            border-color: #6effb4;
        }

        .task-card.completed {
            opacity: 0.6;
            border-color: rgba(110, 255, 180, 0.5);
            background: rgba(20, 70, 60, 0.3);
        }

        .task-header {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .task-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, rgba(110, 255, 180, 0.2), rgba(77, 204, 143, 0.2));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            border: 2px solid rgba(110, 255, 180, 0.3);
            flex-shrink: 0;
        }

        .task-info {
            flex: 1;
        }

        .task-title {
            color: #6effb4;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .task-points {
            color: #ffd700;
            font-size: 16px;
            font-weight: bold;
        }

        .task-description {
            color: #a8e6cf;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .task-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .claim-btn {
            flex: 1;
            padding: 12px 20px;
            background: linear-gradient(135deg, #6effb4, #4dcc8f);
            border: none;
            border-radius: 10px;
            color: #0a3d2e;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .claim-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(110, 255, 180, 0.5);
        }

        .claim-btn:disabled {
            background: rgba(100, 100, 100, 0.5);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .task-status {
            padding: 8px 16px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: bold;
        }

        .task-status.completed {
            background: rgba(110, 255, 180, 0.2);
            color: #6effb4;
            border: 2px solid rgba(110, 255, 180, 0.4);
        }

        .level-up-notification {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.5);
            z-index: 2000;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.95), rgba(255, 237, 78, 0.95));
            backdrop-filter: blur(15px);
            border-radius: 30px;
            padding: 50px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(255, 215, 0, 0.6), 0 0 100px rgba(255, 215, 0, 0.4);
            border: 4px solid #ffd700;
            min-width: 400px;
            animation: levelUpAppear 0.5s ease forwards;
        }

        .level-up-notification.active {
            display: block;
        }

        @keyframes levelUpAppear {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        .level-up-icon {
            font-size: 100px;
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-20px);
            }
        }

        .level-up-text {
            font-size: 48px;
            font-weight: bold;
            color: #0a3d2e;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .level-up-number {
            font-size: 72px;
            font-weight: bold;
            color: #0a3d2e;
            margin: 20px 0;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
        }

        .level-up-message {
            font-size: 20px;
            color: #1a5c4a;
            margin-bottom: 30px;
        }

        .level-up-close {
            padding: 15px 40px;
            background: #0a3d2e;
            color: #ffd700;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .level-up-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .level-up-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1999;
        }

        .level-up-overlay.active {
            display: block;
        }

        .profile
-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .profile-header-card {
            background: rgba(20, 70, 60, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            border: 2px solid rgba(110, 255, 180, 0.3);
            display: flex;
            gap: 30px;
            align-items: flex-start;
            flex-wrap: wrap;
        }

        .profile-avatar-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .profile-avatar-large {
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 70px;
            box-shadow: 0 8px 30px rgba(139, 92, 246, 0.5);
            overflow: hidden;
            border: 4px solid rgba(110, 255, 180, 0.3);
        }

        .profile-avatar-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .change-avatar-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #6effb4, #4dcc8f);
            border: none;
            border-radius: 10px;
            color: #0a3d2e;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .change-avatar-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(110, 255, 180, 0.5);
        }

        .profile-info-section {
            flex: 1;
            min-width: 300px;
        }

        .profile-name-large {
            color: #6effb4;
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(110, 255, 180, 0.4);
        }

        .profile-stats {
            display: flex;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .profile-stat {
            text-align: center;
        }

        .profile-stat-number {
            font-size: 32px;
            color: #ffd700;
            font-weight: bold;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        .profile-stat-label {
            font-size: 14px;
            color: #a8e6cf;
            margin-top: 5px;
        }

        .profile-bio-card {
            background: rgba(20, 70, 60, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid rgba(110, 255, 180, 0.3);
        }

        .profile-bio-card h3 {
            color: #6effb4;
            font-size: 24px;
            margin-bottom: 15px;
        }

        .profile-bio-text {
            color: #a8e6cf;
            line-height: 1.6;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .edit-bio-btn {
            padding: 10px 20px;
            background: rgba(110, 255, 180, 0.2);
            border: 2px solid rgba(110, 255, 180, 0.4);
            border-radius: 10px;
            color: #6effb4;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .edit-bio-btn:hover {
            background: rgba(110, 255, 180, 0.3);
            transform: translateY(-2px);
        }

        .profile-bio-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border-radius: 10px;
            border: 2px solid rgba(110, 255, 180, 0.3);
            background: rgba(10, 50, 40, 0.5);
            color: #c5f5d7;
            font-size: 16px;
            margin-bottom: 10px;
            font-family: inherit;
            resize: vertical;
        }

        .profile-bio-textarea:focus {
            outline: none;
            border-color: #6effb4;
            box-shadow: 0 0 15px rgba(110, 255, 180, 0.3);
        }

        .profile-section-title {
            color: #6effb4;
            font-size: 28px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .log-history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .log-history-item {
            background: rgba(20, 70, 60, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(110, 255, 180, 0.2);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s ease;
        }

        .log-history-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(110, 255, 180, 0.3);
            border-color: #6effb4;
        }

        .log-history-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, rgba(110, 255, 180, 0.2), rgba(77, 204, 143, 0.2));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            border: 2px solid rgba(110, 255, 180, 0.3);
            flex-shrink: 0;
        }

        .log-history-details {
            flex: 1;
        }

        .log-history-action {
            color: #6effb4;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .log-history-time {
            color: #a8e6cf;
            font-size: 14px;
        }

        .name-change-warning {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
            color: #ffd700;
            font-size: 14px;
        }

        .settings-menu {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .settings-item {
            padding: 15px 20px;
            background: rgba(20, 70, 60, 0.6);
            border: 2px solid rgba(110, 255, 180, 0.2);
            border-radius: 10px;
            color: #6effb4;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
        }

        .settings-item:hover {
            background: rgba(110, 255, 180, 0.2);
            border-color: #6effb4;
            transform: translateX(5px);
        }

        .settings-item.logout {
            color: #ff6b6b;
            border-color: rgba(255, 107, 107, 0.3);
        }

        .settings-item.logout:hover {
            background: rgba(255, 107, 107, 0.2);
            border-color: #ff6b6b;
        }

        .account-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        .account-item {
            background: rgba(20, 70, 60, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(110, 255, 180, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .account-item:hover {
            border-color: #6effb4;
            box-shadow: 0 5px 20px rgba(110, 255, 180, 0.3);
        }

        .account-item.active {
            border-color: #6effb4;
            background: rgba(110, 255, 180, 0.1);
        }

        .account-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            overflow: hidden;
        }

        .account-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .account-info {
            flex: 1;
        }

        .account-name {
            color: #6effb4;
            font-size: 18px;
            font-weight: bold;
        }

        .account-points {
            color: #a8e6cf;
            font-size: 14px;
        }

        .add-account-btn {
            width: 100%;
            padding: 15px;
            background: rgba(110, 255, 180, 0.2);
            border: 2px dashed rgba(110, 255, 180, 0.4);
            border-radius: 10px;
            color: #6effb4;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .add-account-btn:hover {
            background: rgba(110, 255, 180, 0.3);
            border-color: #6effb4;
        }

        .notif-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .notif-item {
            background: rgba(20, 70, 60, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(110, 255, 180, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .notif-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(110, 255, 180, 0.3);
            border-color: #6effb4;
        }

        .notif-item.unread {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
        }

        .notif-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, rgba(110, 255, 180, 0.2), rgba(77, 204, 143, 0.2));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 2px solid rgba(110, 255, 180, 0.3);
            flex-shrink: 0;
        }

        .notif-content {
            flex: 1;
        }

        .notif-title {
            color: #6effb4;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .notif-message {
            color: #a8e6cf;
            font-size: 14px;
        }

        .notif-time {
            color: #a8e6cf;
            font-size: 12px;
            font-style: italic;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            background: rgba(20, 70, 60, 0.6);
            border: 2px solid rgba(110, 255, 180, 0.2);
            border-radius: 10px;
            color: #a8e6cf;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            text-align: center;
        }

        .auth-tab.active {
            background: rgba(110, 255, 180, 0.2);
            border-color: #6effb4;
            color: #6effb4;
        }

        .auth-tab:hover {
            background: rgba(110, 255, 180, 0.15);
            border-color: #6effb4;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                top: 0;
            }

            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 20px;
            }

            .header {
                flex-direction: column;
                height: auto;
                padding: 15px;
                gap: 10px;
            }

            .header-left,
            .header-right {
                flex-wrap: wrap;
                justify-content: center;
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }

            .missions-grid {
                grid-template-columns: 1fr;
            }

            .plant-card.expanded {
                transform: scale(1.05);
            }

            .level-up-notification, .points-popup, .info-popup {
                min-width: 90%;
                padding: 30px 20px;
            }

            .level-up-text, .points-popup-text, .info-popup-title {
                font-size: 28px;
            }

            .level-up-number, .points-popup-amount {
                font-size: 48px;
            }

            .profile-header-card {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .profile-stats {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation">
        <div class="floating-particle"></div>
        <div class="floating-particle"></div>
        <div class="floating-particle"></div>
        <div class="floating-particle"></div>
        <div class="floating-particle"></div>
        <div class="raindrop"></div>
        <div class="raindrop"></div>
        <div class="raindrop"></div>
        <div class="raindrop"></div>
        <div class="raindrop"></div>
        <div class="raindrop"></div>
        <div class="raindrop"></div>
        <div class="raindrop"></div>
    </div>

    <div class="points-popup" id="pointsPopup">
        <div class="points-popup-icon"></div>
        <div class="points-popup-text">You Got Points!</div>
        <div class="points-popup-amount" id="pointsPopupAmount">+50</div>
    </div>

    <div class="info-popup" id="infoPopup">
        <div class="info-popup-icon"></div>
        <div class="info-popup-title" id="infoPopupTitle">Cannot Claim Points</div>
        <div class="info-popup-message" id="infoPopupMessage">Please complete the required action first.</div>
        <button class="info-popup-close" onclick="closeInfoPopup()">Got It</button>
    </div>

    <div class="level-up-overlay" id="levelUpOverlay"></div>
    <div class="level-up-notification" id="levelUpNotification">
        <div class="level-up-icon"></div>
        <div class="level-up-text">LEVEL UP!</div>
        <div class="level-up-number" id="newLevelNumber">2</div>
        <div class="level-up-message">Congratulations! Keep growing your garden!</div>
        <button class="level-up-close" onclick="closeLevelUp()">AWESOME!</button>
    </div>

    <div id="nameSetupModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Welcome, Planter!</h2>
            </div>
            <p style="color: #a8e6cf; margin-bottom: 20px;">Let's personalize your experience! What should we call you?</p>
            <div class="form-group">
                <label>Your Name</label>
                <input type="text" id="setupNameInput" placeholder="Enter your name" maxlength="30">
            </div>
            <p style="color: #a8e6cf; font-size: 12px; margin-bottom: 20px;">You can change this once per week in your profile.</p>
            <button class="submit-btn" onclick="saveInitialName()">Get Started!</button>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2> Settings</h2>
                <button class="close-btn" onclick="closeSettingsModal()">&times;</button>
            </div>
            <div class="settings-menu">
                <div class="settings-item" onclick="openChangePasswordModal()">
                     Change Password
                </div>
                <div class="settings-item" onclick="openAccountsModal()">
                     Change Account
                </div>
                <div class="settings-item logout" onclick="openLogoutModal()">
                     Log Out
                </div>
            </div>
        </div>
    </div>

    <div id="changePasswordModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2> Change Password</h2>
                <button class="close-btn" onclick="closeChangePasswordModal()">&times;</button>
            </div>
            <div class="form-group">
                <label>Current Password</label>
                <input type="password" id="currentPassword" placeholder="Enter current password">
            </div>
            <div class="form-group">
                <label>New Password</label>
                <input type="password" id="newPassword" placeholder="Enter new password">
            </div>
            <div class="form-group">
                <label>Confirm New Password</label>
                <input type="password" id="confirmPassword" placeholder="Confirm new password">
            </div>
            <button class="submit-btn" onclick="changePassword()">Change Password</button>
        </div>
    </div>

    <div id="accountsModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2> Manage Accounts</h2>
                <button class="close-btn" onclick="closeAccountsModal()">&times;</button>
            </div>
            <div class="account-list" id="accountsList">
            </div>
            <button class="add-account-btn" onclick="openAuthModal()">
                 Add New Account
            </button>
        </div>
    </div>

    <div id="authModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h2> Account Authentication</h2>
                <button class="close-btn" onclick="closeAuthModal()">&times;</button>
            </div>
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="switchAuthTab('signin')">Sign In</div>
                <div class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</div>
            </div>
            
            <form id="signinForm" class="auth-form active" onsubmit="handleSignIn(event)">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="signinUsername" required placeholder="Enter username">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="signinPassword" required placeholder="Enter password">
                </div>
                <button type="submit" class="submit-btn">Sign In</button>
            </form>

            <form id="signupForm" class="auth-form" onsubmit="handleSignUp(event)">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="signupName" required placeholder="Enter your name" maxlength="30">
                </div>
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="signupUsername" required placeholder="Choose a username" maxlength="20">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="signupPassword" required placeholder="Choose a password" minlength="6">
                </div>
                <div class="form-group">
                    <label>Confirm Password</label>
                    <input type="password" id="signupConfirmPassword" required placeholder="Confirm your password">
                </div>
                <button type="submit" class="submit-btn">Create Account</button>
            </form>
        </div>
    </div>

    <div id="logoutModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2> Logout Confirmation</h2>
            </div>
            <p style="color: #a8e6cf; margin-bottom: 30px; font-size: 16px; text-align: center;">Are you sure you want to log out?</p>
            <div style="display: flex; gap: 15px;">
                <button class="submit-btn" style="background: rgba(100, 100, 100, 0.5);" onclick="closeLogoutModal()">Cancel</button>
                <button class="submit-btn" onclick="confirmLogout()">Yes, Logout</button>
            </div>
        </div>
    </div>

    <div id="updatePlantPictureModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2> Update Plant Picture</h2>
                <button class="close-btn" onclick="closeUpdatePlantPictureModal()">&times;</button>
            </div>
            <div id="currentPlantPicturePreview" style="text-align: center; margin-bottom: 20px;"></div>
            <div class="form-group">
                <label>Upload New Picture</label>
                <input type="file" id="updatePlantImage" accept="image/*" onchange="previewNewPlantImage(event)">
                <div id="newPlantImagePreview" style="margin-top: 15px; text-align: center;"></div>
            </div>
            <button class="submit-btn" onclick="saveUpdatedPlantPicture()"> Update Picture</button>
        </div>
    </div>

    <div class="header">
        <div class="header-left">
            <div class="logo">
                <div class="logo-icon"></div>
                <span>LEAF IT UP!</span>
            </div>
            <div class="header-profile" onclick="showSection('profile')">
                <div class="mini-avatar" id="headerAvatar"></div>
                <span class="profile-name" id="headerProfileName">Planter</span>
            </div>
        </div>
        <div class="header-right">
            <div class="points-mini">
                 <span id="pointsDisplay">0</span>
            </div>
            <div class="level-badge" id="levelBadge" onclick="toggleLevelProgress()"> LEVEL 1</div>
            <button class="weather-toggle" onclick="toggleWeather()"></button>
            <button class="notif-btn" onclick="showSection('notifications')">
                
                <span class="notif-badge" id="notifBadge" style="display: none;">0</span>
            </button>
            <button class="settings-btn" onclick="openSettingsModal()"></button>
        </div>
    </div>

    <div id="levelProgressModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2> Level Progress</h2>
                <button class="close-btn" onclick="closeLevelProgress()">&times;</button>
            </div>
            <div style="text-align: center; margin-bottom: 20px;">
                <div style="font-size: 48px; color: #ffd700; font-weight: bold;" id="currentLevelDisplay">1</div>
                <p style="color: #a8e6cf; margin-top: 10px;">Current Level</p>
            </div>
            <div style="margin: 30px 0;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span style="color: #6effb4; font-weight: bold;" id="currentPointsText">0 PTS</span>
                    <span style="color: #a8e6cf;" id="nextLevelText">500 PTS</span>
                </div>
                <div style="background: rgba(10, 50, 40, 0.5); height: 30px; border-radius: 15px; overflow: hidden; border: 2px solid rgba(110, 255, 180, 0.3);">
                    <div id="progressBar" style="background: linear-gradient(90deg, #6effb4, #4dcc8f); height: 100%; width: 0%; transition: width 0.5s ease; display: flex; align-items: center; justify-content: center; color: #0a3d2e; font-weight: bold; font-size: 14px;"></div>
                </div>
            </div>
            <p style="color: #a8e6cf; text-align: center; font-size: 14px;">Keep logging plants and completing tasks to level up!</p>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <div class="menu-item active" onclick="showSection('home')"> HOME</div>
            <div class="menu-item" onclick="showSection('plants')"> MY PLANTS</div>
            <div class="menu-item" onclick="showSection('tips')"> TIPS</div>
            <div class="menu-item" onclick="showSection('leaderboard')"> LEADERBOARD</div>
            <div class="menu-item" onclick="showSection('community')"> COMMUNITY PROGRESS</div>
            <div class="menu-item" onclick="showSection('reward')"> REWARDS</div>
            <div class="menu-item" onclick="showSection('profile')"> PROFILE</div>
        </div>

        <div class="main-content">
            <div id="home" class="page-section active">
                <div class="greeting-section" id="greetingSection">
                    <h1 id="greetingText">Hello Planter!</h1>
                    <p id="greetingSubtext">Welcome to your plant tracking dashboard</p>
                </div>

                <div class="announcement-board">
                    <h2> Announcements & Events</h2>
                    <div class="announcements-list" id="announcementsList">
                        <div class="no-announcements">
                            <div class="no-announcements-icon"></div>
                            <h3 style="color: #a8e6cf; margin-bottom: 10px;">No Announcements for Today</h3>
                            <p style="color: #8dc5a7;">Check back later for updates and events!</p>
                        </div>
                    </div>
                </div>

                <div class="cards-grid">
                    <div class="feature-card" onclick="openLogPlantModal()">
                        <div class="card-icon"></div>
                        <h3>LOG PLANTS</h3>
                        <p>Track your new plants and watch them grow in your digital garden</p>
                    </div>
                    <div class="feature-card" onclick="showSection('plants')">
                        <div class="card-icon"></div>
                        <h3>MY PLANTS</h3>
                        <p>View and manage all your registered plants and their progress</p>
                    </div>
                    <div class="feature-card" onclick="showSection('tips')">
                        <div class="card-icon"></div>
                        <h3>TIPS</h3>
                        <p>Learn expert advice to keep your plants healthy and thriving</p>
                    </div>
                </div>

                <div class="daily-missions-section">
                    <h2> Daily Missions</h2>
                    <div class="missions-grid" id="dailyMissionsGrid"></div>
                    <div class="mission-timer">
                        <p class="mission-timer-text"> Missions reset in: <span id="missionTimer">00:00:00</span></p>
                    </div>
                </div>
            </div>

            <div id="plants" class="page-section">
                <button class="log-plant-btn-top" onclick="openLogPlantModal()">
                     Log New Plant
                </button>
                <h2 style="color: #6effb4; font-size: 32px; margin-bottom: 20px;"> My Plant Library</h2>
                <div id="plantsContainer" class="plants-grid">
                    <div class="empty-state">
                        <div class="empty-state-icon"></div>
                        <h3>No plants logged yet!</h3>
                        <p>Start by logging your first plant to build your garden.</p>
                    </div>
                </div>
            </div>

            <div id="tips" class="page-section">
                <h2 style="color: #6effb4; font-size: 32px; margin-bottom: 20px;"> Expert Plant Care Tips</h2>
                <div class="tips-list">
                    <div class="tip-card">
                        <h3> Watering Wisdom</h3>
                        <p>Most plants prefer consistent watering schedules. Check the soil moisture before watering - stick your finger about 2 inches deep. If it's dry, it's time to water. Overwatering is often more harmful than underwatering, so when in doubt, wait another day!</p>
                    </div>
                    <div class="tip-card">
                        <h3> Light Requirements</h3>
                        <p>Understanding your plant's light needs is crucial. "Bright indirect light" means near a window but not in direct sun rays. "Low light" doesn't mean no light - all plants need some light to photosynthesize. Rotate your plants weekly for even growth!</p>
                    </div>
                    <div class="tip-card">
                        <h3> Temperature & Humidity</h3>
                        <p>Most houseplants thrive in temperatures between 65-75F (18-24C). Avoid placing plants near heating vents, air conditioners, or drafty windows. Increase humidity by grouping plants together, using a pebble tray, or running a humidifier nearby.</p>
                    </div>
                    <div class="tip-card">
                        <h3> Fertilizing Facts</h3>
                        <p>Feed your plants during their growing season (spring and summer) with a balanced fertilizer diluted to half strength. Too much fertilizer can burn roots and damage your plant. During fall and winter, most plants rest and need little to no fertilizer.</p>
                    </div>
                    <div class="tip-card">
                        <h3> Pruning & Maintenance</h3>
                        <p>Regular pruning keeps plants healthy and encourages bushier growth. Remove dead or yellowing leaves promptly to prevent disease spread. Dust leaves monthly with a damp cloth to help plants breathe and photosynthesize efficiently. Clean pots and check for pests regularly!</p>
                    </div>
                </div>
            </div>

            <div id="leaderboard" class="page-section">
                <h2 style="color: #6effb4; font-size: 32px; text-align: center; margin-bottom: 40px;"> LEADERBOARDS</h2>
                <div class="podium-container" id="podiumContainer">
                    <div class="podium-item second-place">
                        <div class="podium-avatar purple" id="podium2Avatar"><span></span></div>
                        <div class="podium-rank">2nd</div>
                        <div class="podium-name" id="player2Name">---</div>
                        <div class="podium-points" id="player2Points">0 PTS</div>
                    </div>
                    <div class="podium-item first-place">
                        <div class="podium-avatar green" id="podium1Avatar"><span></span></div>
                        <div class="podium-rank">1ST</div>
                        <div class="podium-name" id="player1Name">---</div>
                        <div class="podium-points" id="player1Points">0 PTS</div>
                    </div>
                    <div class="podium-item third-place">
                        <div class="podium-avatar olive" id="podium3Avatar"><span></span></div>
                        <div class="podium-rank">3RD</div>
                        <div class="podium-name" id="player3Name">---</div>
                        <div class="podium-points" id="player3Points">0 PTS</div>
                    </div>
                </div>
                <div class="rankings-list" id="rankingsList">
                    <div class="empty-state">
                        <div class="empty-state-icon"></div>
                        <h3>No rankings yet!</h3>
                        <p>Start logging plants to compete on the leaderboard!</p>
                    </div>
                </div>
            </div>

            <div id="community" class="page-section">
                <h2 style="color: #6effb4; font-size: 32px; margin-bottom: 30px;"> Community Progress</h2>
                <div class="cards-grid" style="margin-bottom: 40px;">
                    <div class="feature-card">
                        <div class="card-icon"></div>
                        <h3 id="totalCommunityPlants">0</h3>
                        <p>Total Plants Logged</p>
                    </div>
                    <div class="feature-card">
                        <div class="card-icon"></div>
                        <h3 id="totalLocations">0</h3>
                        <p>Locations Tracked</p>
                    </div>
                    <div class="feature-card">
                        <div class="card-icon"></div>
                        <h3 id="activePlanters">1</h3>
                        <p>Active Planters</p>
                    </div>
                </div>
                <div style="background: rgba(20, 70, 60, 0.6); backdrop-filter: blur(10px); border-radius: 20px; padding: 30px; margin-bottom: 40px; border: 2px solid rgba(110, 255, 180, 0.2);">
                    <h3 style="color: #6effb4; font-size: 24px; margin-bottom: 20px;"> Plants Location Map</h3>
                    <div id="communityMap"></div>
                </div>
                <div style="background: rgba(20, 70, 60, 0.6); backdrop-filter: blur(10px); border-radius: 20px; padding: 30px; border: 2px solid rgba(110, 255, 180, 0.2);">
                    <h3 style="color: #6effb4; font-size: 24px; margin-bottom: 20px;"> Plants Logged Per Month</h3>
                    <canvas id="communityChart" style="max-height: 300px;"></canvas>
                </div>
                <div style="margin-top: 40px;">
                    <h3 style="color: #6effb4; font-size: 24px; margin-bottom: 20px;"> Recent Plant Activity</h3>
                    <div id="recentActivity" class="tips-list">
                        <div class="tip-card" style="text-align: center; color: #a8e6cf;">
                            <p>No recent activity yet. Start logging plants!</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="reward" class="page-section">
                <h2 style="color: #6effb4; font-size: 32px; margin-bottom: 20px;"> Rewards</h2>
                <div class="rewards-header">
                    <h3 style="color: #a8e6cf; font-size: 18px;">YOUR POINTS</h3>
                    <div class="rewards-points" id="rewardsPoints">0</div>
                    <p style="color: #a8e6cf;">Redeem points for planting supplies!</p>
                </div>
                <div style="text-align: center; margin-bottom: 40px;">
                    <button class="submit-btn" style="max-width: 400px; margin: 0 auto;" onclick="showSection('tasks')"> CLAIM POINTS</button>
                </div>
                <h3 style="color: #6effb4; font-size: 24px; margin-bottom: 20px;"> Available Items</h3>
                <div class="rewards-grid" id="rewardsGrid"></div>
                <div class="history-section">
                    <h3 style="color: #6effb4; font-size: 24px; margin-bottom: 20px;"> Redemption History</h3>
                    <div class="history-tabs">
                        <div class="history-tab active" onclick="switchHistoryTab('pending')"> Pending</div>
                        <div class="history-tab" onclick="switchHistoryTab('approved')"> Approved</div>
                    </div>
                    <div id="pendingHistory" class="history-content active">
                        <div class="empty-state">
                            <div class="empty-state-icon"></div>
                            <h3>No pending redemptions</h3>
                            <p>Your pending redemptions will appear here</p>
                        </div>
                    </div>
                    <div id="approvedHistory" class="history-content">
                        <div class="empty-state">
                            <div class="empty-state-icon"></div>
                            <h3>No approved redemptions yet</h3>
                            <p>Your approved redemptions will appear here</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tasks" class="page-section">
                <button class="submit-btn" style="max-width: 200px; margin-bottom: 20px;" onclick="showSection('reward')"> Back to Rewards</button>
                <h2 style="color: #6effb4; font-size: 32px; margin-bottom: 20px;"> Claim Points</h2>
                <p style="color: #a8e6cf; margin-bottom: 30px; font-size: 16px;">Complete tasks to earn points and level up!</p>
                <div id="tasksContainer" class="tasks-grid"></div>
            </div>

            <div id="notifications" class="page-section">
                <h2 style="color: #6effb4; font-size: 32px; margin-bottom: 20px;"> Notifications</h2>
                <div id="notificationsList" class="notif-list">
                    <div class="empty-state">
                        <div class="empty-state-icon"></div>
                        <h3>No notifications yet!</h3>
                        <p>Your notifications will appear here</p>
                    </div>
                </div>
            </div>

            <div id="profile" class="page-section">
                <div class="profile-container">
                    <h2 style="color: #6effb4; font-size: 32px; margin-bottom: 30px;"> My Profile</h2>
                    <div class="profile-header-card">
                        <div class="profile-avatar-section">
                            <div class="profile-avatar-large" id="profileAvatar"></div>
                            <button class="change-avatar-btn" onclick="openAvatarModal()">Change Photo</button>
                        </div>
                        <div class="profile-info-section">
                            <div class="profile-name-large" id="profileDisplayName">Planter</div>
                            <button class="edit-bio-btn" onclick="openEditNameModal()" style="margin-bottom: 15px;">Change Name</button>
                            <div class="profile-stats">
                                <div class="profile-stat">
                                    <div class="profile-stat-number" id="profilePoints">0</div>
                                    <div class="profile-stat-label">Points</div>
                                </div>
                                <div class="profile-stat">
                                    <div class="profile-stat-number" id="profileLevel">1</div>
                                    <div class="profile-stat-label">Level</div>
                                </div>
                                <div class="profile-stat">
                                    <div class="profile-stat-number" id="profilePlants">0</div>
                                    <div class="profile-stat-label">Plants</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="profile-bio-card">
                        <h3> Bio</h3>
                        <div id="bioDisplay">
                            <p class="profile-bio-text" id="bioText">Plant enthusiast  | Growing green one plant at a time!</p>
                            <button class="edit-bio-btn" onclick="editBio()">Edit Bio</button>
                        </div>
                        <div id="bioEdit" style="display: none;">
                            <textarea class="profile-bio-textarea" id="bioTextarea"></textarea>
                            <button class="submit-btn" onclick="saveBio()">Save Bio</button>
                        </div>
                    </div>
                    <div class="profile-bio-card">
                        <h3 class="profile-section-title"> Plants Logged</h3>
                        <div id="profilePlantsGrid" class="plants-grid">
                            <div class="empty-state">
                                <div class="empty-state-icon"></div>
                                <h3>No plants logged yet!</h3>
                                <p>Start logging plants to see them here.</p>
                            </div>
                        </div>
                    </div>
                    <div class="profile-bio-card">
                        <h3 class="profile-section-title"> Activity Log</h3>
                        <div id="profileLogHistory" class="log-history-list">
                            <div class="empty-state">
                                <div class="empty-state-icon"></div>
                                <h3>No activity yet!</h3>
                                <p>Your activity history will appear here.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="logPlantModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2> Log New Plant</h2>
                <button class="close-btn" onclick="closeLogPlantModal()">&times;</button>
            </div>
            <form id="plantForm" onsubmit="submitPlant(event)">
                <div class="form-group">
                    <label>Plant Name *</label>
                    <input type="text" id="plantName" required placeholder="e.g., Monstera Deliciosa">
                </div>
                <div class="form-group">
                    <label>Plant Type *</label>
                    <select id="plantType" required>
                        <option value="">Select type...</option>
                        <option value="Succulent">Succulent</option>
                        <option value="Fern">Fern</option>
                        <option value="Flowering">Flowering Plant</option>
                        <option value="Foliage">Foliage Plant</option>
                        <option value="Herb">Herb</option>
                        <option value="Cactus">Cactus</option>
                        <option value="Vine">Vine</option>
                        <option value="Tree">Tree</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Date Planted *</label>
                    <input type="date" id="datePlanted" required>
                </div>
                <div class="form-group">
                    <label>Plant Location (Click on map to pin) *</label>
                    <div id="map"></div>
                    <input type="hidden" id="plantLat" required>
                    <input type="hidden" id="plantLng" required>
                    <p id="locationDisplay" style="color: #6effb4; margin-top: 10px; font-size: 14px;">Click on the map to select location</p>
                </div>
                <div class="form-group">
                    <label>Watering Frequency</label>
                    <select id="wateringFreq">
                        <option value="Daily">Daily</option>
                        <option value="Every 2-3 days">Every 2-3 days</option>
                        <option value="Weekly">Weekly</option>
                        <option value="Bi-weekly">Bi-weekly</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Upload Photo (Optional)</label>
                    <input type="file" id="plantImage" accept="image/*" onchange="previewImage(event)">
                    <div id="imagePreview" style="margin-top: 10px;"></div>
                </div>
                <div class="form-group">
                    <label>Notes (Optional)</label>
                    <textarea id="plantNotes" rows="3" placeholder="Any additional notes about your plant..."></textarea>
                </div>
                <button type="submit" class="submit-btn"> LOG PLANT</button>
            </form>
        </div>
    </div>

    <div id="avatarModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2> Change Profile Photo</h2>
                <button class="close-btn" onclick="closeAvatarModal()">&times;</button>
            </div>
            <div class="form-group">
                <label>Upload New Photo</label>
                <input type="file" id="avatarImage" accept="image/*" onchange="previewAvatar(event)">
                <div id="profileImagePreview" style="margin-top: 10px; text-align: center;"></div>
            </div>
            <button class="submit-btn" onclick="saveAvatar()"> Save Photo</button>
        </div>
    </div>

    <div id="editNameModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2> Change Name</h2>
                <button class="close-btn" onclick="closeEditNameModal()">&times;</button>
            </div>
            <div class="form-group">
                <label>New Name</label>
                <input type="text" id="editNameInput" placeholder="Enter new name" maxlength="30">
            </div>
            <div id="nameChangeWarning" class="name-change-warning" style="display: none;">
                 You can only change your name once per week. Next change available: <span id="nextChangeDate"></span>
            </div>
            <button class="submit-btn" id="saveNameBtn" onclick="saveNewName()">Save Name</button>
        </div>
    </div>

    <script>
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playClaimSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        function playRedeemSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.frequency.value = 600;
            oscillator.type = 'square';
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.4);
        }

        function playLevelUpSound() {
            const notes = [523.25, 659.25, 783.99];
            notes.forEach((freq, index) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.frequency.value = freq;
                oscillator.type = 'sine';
                const startTime = audioContext.currentTime + (index * 0.15);
                gainNode.gain.setValueAtTime(0.3, startTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.5);
                oscillator.start(startTime);
                oscillator.stop(startTime + 0.5);
            });
        }

        function playWaterSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.frequency.value = 400;
            oscillator.type = 'sine';
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        function showPointsPopup(points) {
            const popup = document.getElementById('pointsPopup');
            const amountEl = document.getElementById('pointsPopupAmount');
            amountEl.textContent = '+' + points;
            popup.classList.add('active');
            playClaimSound();
            
            setTimeout(() => {
                popup.classList.add('closing');
                setTimeout(() => {
                    popup.classList.remove('active', 'closing');
                }, 300);
            }, 1500);
        }

        function showInfoPopup(title, message) {
            const popup = document.getElementById('infoPopup');
            document.getElementById('infoPopupTitle').textContent = title;
            document.getElementById('infoPopupMessage').textContent = message;
            popup.classList.add('active');
        }

        function closeInfoPopup() {
            const popup = document.getElementById('infoPopup');
            popup.classList.add('closing');
            setTimeout(() => {
                popup.classList.remove('active', 'closing');
            }, 300);
        }

        let plants = [];
        let userPoints = 0;
        let currentLevel = 1;
        let weatherMode = 'night';
        let communityChart = null;
        let map = null;
        let communityMap = null;
        let plantMarker = null;
        let selectedLocation = null;
        let currentAccountId = 'account_1';
        let accounts = {};
        let userProfile = {
            name: '',
            bio: 'Plant enthusiast  | Growing green one plant at a time!',
            avatar: null,
            lastNameChange: null,
            password: 'password123',
            username: 'user1'
        };
        let activityLog = [];
        let notifications = [];
        let currentPlantIndexForUpdate = null;
        
        let announcements = [];
        
        const dailyMissionsTemplate = [
            { id: 1, title: 'Morning Check-In', description: 'Log into Leaf It Up to check your plants', points: 25, icon: '', completed: false },
            { id: 2, title: 'Plant Logger', description: 'Log at least one plant today', points: 50, icon: '', completed: false },
            { id: 3, title: 'Green Thumb', description: 'Water your plant and log the activity', points: 30, icon: '', completed: false },
            { id: 4, title: 'Knowledge Seeker', description: 'Read at least one plant care tip', points: 20, icon: '', completed: false },
            { id: 5, title: 'Community Explorer', description: 'Visit the Community Progress page', points: 15, icon: '', completed: false }
        ];

        let dailyMissions = [];
        let lastMissionReset = null;

        const tasks = [
            { id: 1, title: 'Share on Social Media', description: 'Share your plant journey on Facebook, Instagram, or Twitter with #LeafItUp', points: 100, icon: '', completed: false },
            { id: 2, title: 'Invite a Friend', description: 'Invite a friend to join Leaf It Up and start their plant tracking journey', points: 150, icon: '', completed: false },
            { id: 3, title: 'Water Your Plant', description: 'Water one of your registered plants today and keep it healthy', points: 50, icon: '', completed: false },
            { id: 4, title: 'Take a Plant Photo', description: 'Upload a new photo of your plant to track its growth', points: 75, icon: '', completed: false },
            { id: 5, title: 'Read Plant Tips', description: 'Visit the Tips section and learn about plant care', points: 25, icon: '', completed: false },
            { id: 6, title: 'Log 5 Plants', description: 'Reach the milestone of logging 5 different plants', points: 200, icon: '', completed: false }
        ];
        
        const rewardItems = [
            { id: 1, name: 'Watering Can', icon: '', price: 5000 },
            { id: 2, name: 'Plant Fertilizer', icon: '', price: 7500 },
            { id: 3, name: 'Gardening Gloves', icon: '', price: 6000 },
            { id: 4, name: 'Plant Pot', icon: '', price: 10000 },
            { id: 5, name: 'Seed Pack', icon: '', price: 4000 },
            { id: 6, name: 'Pruning Shears', icon: '', price: 8500 },
            { id: 7, name: 'Soil Mix', icon: '', price: 5500 },
            { id: 8, name: 'Plant Food', icon: '', price: 7000 }
        ];

        let redemptionHistory = { pending: [], approved: [] };
        const leaderboardData = [{ name: '', points: 0, avatar: null }];

        const plantIcon = L.divIcon({
            className: 'custom-plant-marker',
            html: '<div style="font-size: 32px; text-align: center;"></div>',
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });

        function renderAnnouncements() {
            const container = document.getElementById('announcementsList');
            
            if (announcements.length === 0) {
                container.innerHTML = `
                    <div class="no-announcements">
                        <div class="no-announcements-icon"></div>
                        <h3 style="color: #a8e6cf; margin-bottom: 10px;">No Announcements for Today</h3>
                        <p style="color: #8dc5a7;">Check back later for updates and events!</p>
                    </div>
                `;
                return;
            }
            
            const sortedAnnouncements = [...announcements].sort((a, b) => new Date(b.date) - new Date(a.date));
            container.innerHTML = sortedAnnouncements.map(announcement => `
                <div class="announcement-item">
                    <div class="announcement-header">
                        <div class="announcement-title">${announcement.title}</div>
                        <div class="announcement-date">${new Date(announcement.date).toLocaleDateString()}</div>
                    </div>
                    <div class="announcement-content">${announcement.content}</div>
                    <span class="announcement-type ${announcement.type}">
                        ${announcement.type === 'news' ? ' News' : announcement.type === 'event' ? ' Event' : ' Update'}
                    </span>
                </div>
            `).join('');
        }

        function openUpdatePlantPictureModal(plantIndex) {
            currentPlantIndexForUpdate = plantIndex;
            const plant = plants[plantIndex];
            const modal = document.getElementById('updatePlantPictureModal');
            const currentPreview = document.getElementById('currentPlantPicturePreview');
            
            if (plant.image) {
                currentPreview.innerHTML = `
                    <p style="color: #a8e6cf; margin-bottom: 10px; font-weight: bold;">Current Picture:</p>
                    <img src="${plant.image}" alt="${plant.name}" style="max-width: 250px; max-height: 250px; border-radius: 10px; border: 2px solid rgba(110, 255, 180, 0.3);">
                `;
            } else {
                currentPreview.innerHTML = `
                    <p style="color: #a8e6cf; margin-bottom: 10px;">No current picture available</p>
                    <div style="width: 150px; height: 150px; background: linear-gradient(135deg, rgba(110, 255, 180, 0.1), rgba(77, 204, 143, 0.1)); border-radius: 10px; margin: 0 auto; display: flex; align-items: center; justify-content: center; font-size: 60px; border: 2px dashed rgba(110, 255, 180, 0.3);"></div>
                `;
            }
            
            document.getElementById('newPlantImagePreview').innerHTML = '';
            document.getElementById('updatePlantImage').value = '';
            modal.classList.add('active');
        }

        function closeUpdatePlantPictureModal() {
            document.getElementById('updatePlantPictureModal').classList.remove('active');
            currentPlantIndexForUpdate = null;
        }

        function previewNewPlantImage(event) {
            const preview = document.getElementById('newPlantImagePreview');
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <p style="color: #6effb4; margin-bottom: 10px; font-weight: bold;">New Picture Preview:</p>
                        <img src="${e.target.result}" alt="New Preview" style="max-width: 250px; max-height: 250px; border-radius: 10px; border: 2px solid rgba(110, 255, 180, 0.4); box-shadow: 0 4px 15px rgba(110, 255, 180, 0.3);">
                    `;
                };
                reader.readAsDataURL(file);
            }
        }

        function saveUpdatedPlantPicture() {
            if (currentPlantIndexForUpdate === null) return;
            
            const imageInput = document.getElementById('updatePlantImage');
            if (!imageInput.files || !imageInput.files[0]) {
                showInfoPopup('No Image Selected', 'Please select a new image first before updating!');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                plants[currentPlantIndexForUpdate].image = e.target.result;
                addActivity(`Updated picture for plant: ${plants[currentPlantIndexForUpdate].name}`, '');
                addNotification(' Picture Updated', `You updated the picture for ${plants[currentPlantIndexForUpdate].name}!`, 'plant', plants[currentPlantIndexForUpdate].name, 'plants');
                saveData();
                renderPlants();
                renderProfilePlants();
                closeUpdatePlantPictureModal();
                alert('Plant picture updated successfully!');
            };
            reader.readAsDataURL(imageInput.files[0]);
        }

        function setMaxDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('datePlanted').setAttribute('max', today);
        }

        function calculatePlantAge(plantedDate) {
            const planted = new Date(plantedDate);
            const now = new Date();
            const diffTime = Math.abs(now - planted);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Planted today';
            else if (diffDays === 1) return '1 day old';
            else if (diffDays < 30) return `${diffDays} days old`;
            else if (diffDays < 365) {
                const months = Math.floor(diffDays / 30);
                return months === 1 ? '1 month old' : `${months} months old`;
            } else {
                const years = Math.floor(diffDays / 365);
                const remainingMonths = Math.floor((diffDays % 365) / 30);
                if (remainingMonths === 0) return years === 1 ? '1 year old' : `${years} years old`;
                return `${years} year${years > 1 ? 's' : ''} and ${remainingMonths} month${remainingMonths > 1 ? 's' : ''} old`;
            }
        }

        function daysSinceWatered(lastWateredDate) {
            if (!lastWateredDate) return null;
            const lastWatered = new Date(lastWateredDate);
            const now = new Date();
            const diffTime = Math.abs(now - lastWatered);
            return Math.floor(diffTime / (1000 * 60 * 60 * 24));
        }

        function canWaterToday(plant) {
            if (!plant.wateringLog || plant.wateringLog.length === 0) return true;
            const lastWatered = new Date(plant.wateringLog[plant.wateringLog.length - 1]);
            const today = new Date();
            return lastWatered.toDateString() !== today.toDateString();
        }

        function calculatePlantProgress(plant) {
            if (!plant.wateringLog || plant.wateringLog.length === 0) return 0;
            const daysSince = daysSinceWatered(plant.wateringLog[plant.wateringLog.length - 1]);
            let expectedDays = 7;
            if (plant.watering === 'Daily') expectedDays = 1;
            else if (plant.watering === 'Every 2-3 days') expectedDays = 3;
            else if (plant.watering === 'Weekly') expectedDays = 7;
            else if (plant.watering === 'Bi-weekly') expectedDays = 14;
            const progress = Math.max(0, 100 - ((daysSince / expectedDays) * 50));
            return Math.min(100, progress);
        }

        async function getLocationName(lat, lng) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`);
                const data = await response.json();
                if (data && data.address) {
                    const address = data.address;
                    const parts = [];
                    if (address.road) parts.push(address.road);
                    if (address.suburb) parts.push(address.suburb);
                    else if (address.neighbourhood) parts.push(address.neighbourhood);
                    if (address.city) parts.push(address.city);
                    else if (address.town) parts.push(address.town);
                    else if (address.village) parts.push(address.village);
                    return parts.length > 0 ? parts.join(', ') : 'Unknown Location';
                }
                return 'Unknown Location';
            } catch (error) {
                console.error('Error fetching location name:', error);
                return 'Unknown Location';
            }
        }

        function initMap() {
            map = L.map('map').setView([14.6760, 121.0437], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: ' OpenStreetMap contributors'
            }).addTo(map);

            map.on('click', async function(e) {
                if (plantMarker) map.removeLayer(plantMarker);
                plantMarker = L.marker(e.latlng, {icon: plantIcon}).addTo(map);
                selectedLocation = e.latlng;
                document.getElementById('plantLat').value = e.latlng.lat;
                document.getElementById('plantLng').value = e.latlng.lng;
                document.getElementById('locationDisplay').textContent = 'Loading location...';
                const locationName = await getLocationName(e.latlng.lat, e.latlng.lng);
                document.getElementById('locationDisplay').textContent = `Selected: ${locationName}`;
            });
        }

        function initCommunityMap() {
            if (communityMap) communityMap.remove();
            communityMap = L.map('communityMap').setView([14.6760, 121.0437], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: ' OpenStreetMap contributors'
            }).addTo(communityMap);

            plants.forEach(plant => {
                if (plant.lat && plant.lng) {
                    const marker = L.marker([plant.lat, plant.lng], {icon: plantIcon}).addTo(communityMap);
                    let popupContent = '<div class="popup-content">';
                    if (plant.image) popupContent += `<img src="${plant.image}" class="popup-plant-image" alt="${plant.name}">`;
                    popupContent += `
                        <h4> ${plant.name}</h4>
                        <p><strong>Type:</strong> ${plant.type}</p>
                        <p><strong>Location:</strong> ${plant.locationName || 'Unknown'}</p>
                        <p><strong>Planted:</strong> ${plant.datePlanted}</p>
                        <p><strong>Age:</strong> ${calculatePlantAge(plant.datePlanted)}</p>
                        <p><strong>Watering:</strong> ${plant.watering}</p>
                    `;
                    if (plant.notes) popupContent += `<p><strong>Notes:</strong> ${plant.notes}</p>`;
                    popupContent += '</div>';
                    marker.bindPopup(popupContent, { maxWidth: 250, className: 'custom-popup' });
                }
            });
            setTimeout(() => communityMap.invalidateSize(), 100);
        }

        function checkMissionReset() {
            const now = new Date();
            const today = now.toDateString();
            if (!lastMissionReset || lastMissionReset !== today) {
                dailyMissions = JSON.parse(JSON.stringify(dailyMissionsTemplate));
                lastMissionReset = today;
                saveData();
            }
        }

        function renderDailyMissions() {
            checkMissionReset();
            const container = document.getElementById('dailyMissionsGrid');
            container.innerHTML = dailyMissions.map(mission => `
                <div class="mission-card ${mission.completed ? 'completed' : ''}">
                    <div class="mission-header">
                        <div class="mission-icon">${mission.icon}</div>
                        <div class="mission-info">
                            <div class="mission-title">${mission.title}</div>
                            <div class="mission-points">+${mission.points} Points</div>
                        </div>
                    </div>
                    <div class="mission-description">${mission.description}</div>
                    ${mission.completed ? 
                        '<button class="mission-btn" disabled> Completed</button>' :
                        `<button class="mission-btn" onclick="completeMission(${mission.id})">Complete Mission</button>`
                    }
                </div>
            `).join('');
            updateMissionTimer();
        }

        function completeMission(missionId) {
            const mission = dailyMissions.find(m => m.id === missionId);
            if (!mission || mission.completed) return;
            
            if (missionId === 2 && plants.length === 0) {
                showInfoPopup('Cannot Complete Mission', 'Please log at least one plant first to complete this mission!');
                return;
            }
            if (missionId === 4 && !sessionStorage.getItem('visitedTips')) {
                showInfoPopup('Cannot Complete Mission', 'Please visit the Tips section first to complete this mission!');
                return;
            }
            if (missionId === 5 && !sessionStorage.getItem('visitedCommunity')) {
                showInfoPopup('Cannot Complete Mission', 'Please visit the Community Progress page first to complete this mission!');
                return;
            }
            
            mission.completed = true;
            addPoints(mission.points);
            showPointsPopup(mission.points);
            addActivity(`Completed daily mission: ${mission.title}`, '');
            saveData();
            renderDailyMissions();
        }

        function updateMissionTimer() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            const diff = tomorrow - now;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            const timerElement = document.getElementById('missionTimer');
            if (timerElement) {
                timerElement.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }
        }
        setInterval(updateMissionTimer, 1000);

        function waterPlant(plantIndex) {
            const plant = plants[plantIndex];
            if (!canWaterToday(plant)) {
                showInfoPopup('Already Watered', 'You have already watered this plant today! Plants can only be watered once per day to prevent overwatering.');
                return;
            }
            if (!plant.wateringLog) plant.wateringLog = [];
            const now = new Date().toISOString();
            plant.wateringLog.push(now);
            addPoints(30);
            showPointsPopup(30);
            playWaterSound();
            addActivity(`Watered plant: ${plant.name}`, '');
            addNotification(' Plant Watered', `You watered ${plant.name}! Keep up the great care!`, 'water', null, 'plants');
            saveData();
            renderPlants();
        }

        function addNotification(title, message, type, plantName, redirectTo) {
            const notification = {
                id: Date.now(),
                title: title,
                message: message,
                type: type,
                time: new Date().toLocaleString(),
                unread: true,
                plantName: plantName || null,
                redirectTo: redirectTo || null
            };
            notifications.unshift(notification);
            if (notifications.length > 20) notifications.pop();
            updateNotificationBadge();
            saveData();
        }

        function updateNotificationBadge() {
            const unreadCount = notifications.filter(n => n.unread).length;
            const badge = document.getElementById('notifBadge');
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        function renderNotifications() {
            const container = document.getElementById('notificationsList');
            if (notifications.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon"></div>
                        <h3>No notifications yet!</h3>
                        <p>Your notifications will appear here</p>
                    </div>
                `;
                return;
            }
            container.innerHTML = notifications.map(notif => `
                <div class="notif-item ${notif.unread ? 'unread' : ''}" onclick="handleNotificationClick(${notif.id})">
                    <div class="notif-icon">${getNotifIcon(notif.type)}</div>
                    <div class="notif-content">
                        <div class="notif-title">${notif.title}</div>
                        <div class="notif-message">${notif.message}</div>
                        <div class="notif-time">${notif.time}</div>
                    </div>
                </div>
            `).join('');
        }

        function handleNotificationClick(notifId) {
            const notif = notifications.find(n => n.id === notifId);
            if (notif) {
                notif.unread = false;
                updateNotificationBadge();
                saveData();
                
                if (notif.redirectTo) {
                    showSection(notif.redirectTo);
                }
                renderNotifications();
            }
        }

        function getNotifIcon(type) {
            const icons = {
                water: '',
                reward: '',
                level: '',
                task: '',
                plant: ''
            };
            return icons[type] || '';
        }

        function checkPlantWatering() {
            plants.forEach(plant => {
                const daysSince = daysSinceWatered(plant.wateringLog?.[plant.wateringLog.length - 1]);
                if (daysSince !== null && daysSince >= 2) {
                    const existing = notifications.find(n => n.message.includes(plant.name) && n.type === 'water');
                    if (!existing) {
                        addNotification(' Water Reminder', `${plant.name} needs watering! It's been ${daysSince} days since last watered.`, 'water', plant.name, 'plants');
                    }
                }
            });
        }

        function checkAvailableRewards() {
            const claimableTasks = tasks.filter(t => !t.completed);
            if (claimableTasks.length > 0) {
                const existing = notifications.find(n => n.title.includes('Claimable Tasks'));
                if (!existing) {
                    addNotification(' Claimable Tasks', `You have ${claimableTasks.length} tasks available to claim points!`, 'task', null, 'tasks');
                }
            }
        }

        function checkLevelProgress() {
            const pointsInLevel = userPoints % 500;
            const pointsToNext = 500 - pointsInLevel;
            if (pointsToNext <= 100 && pointsToNext > 0) {
                const existing = notifications.find(n => n.title.includes('Almost There'));
                if (!existing) {
                    addNotification(' Almost There!', `Only ${pointsToNext} more points until Level ${currentLevel + 1}!`, 'level', null, 'home');
                }
            }
        }

        function loadData() {
            const savedAccounts = localStorage.getItem('accounts');
            const savedCurrentAccount = localStorage.getItem('currentAccountId');
            const savedAnnouncements = localStorage.getItem('announcements');
            
            if (savedAccounts) accounts = JSON.parse(savedAccounts);
            if (savedCurrentAccount) currentAccountId = savedCurrentAccount;
            if (savedAnnouncements) announcements = JSON.parse(savedAnnouncements);
            
            if (!accounts[currentAccountId]) {
                accounts[currentAccountId] = {
                    profile: { name: '', bio: 'Plant enthusiast  | Growing green one plant at a time!', avatar: null, lastNameChange: null, password: 'password123', username: 'user1' },
                    points: 0,
                    level: 1,
                    plants: [],
                    tasks: JSON.parse(JSON.stringify(tasks)),
                    redemptions: { pending: [], approved: [] },
                    activity: [],
                    missions: [],
                    lastMissionReset: null,
                    notifications: []
                };
            }
            
            const account = accounts[currentAccountId];
            userProfile = account.profile;
            userPoints = account.points;
            currentLevel = account.level;
            plants = account.plants;
            tasks.forEach((task, i) => task.completed = account.tasks[i]?.completed || false);
            redemptionHistory = account.redemptions;
            activityLog = account.activity;
            dailyMissions = account.missions;
            lastMissionReset = account.lastMissionReset;
            notifications = account.notifications || [];
            
            leaderboardData[0].name = userProfile.name;
            leaderboardData[0].points = userPoints;
            leaderboardData[0].avatar = userProfile.avatar;
        }

        function saveData() {
            accounts[currentAccountId] = {
                profile: userProfile,
                points: userPoints,
                level: currentLevel,
                plants: plants,
                tasks: tasks,
                redemptions: redemptionHistory,
                activity: activityLog,
                missions: dailyMissions,
                lastMissionReset: lastMissionReset,
                notifications: notifications
            };
            localStorage.setItem('accounts', JSON.stringify(accounts));
            localStorage.setItem('currentAccountId', currentAccountId);
            localStorage.setItem('announcements', JSON.stringify(announcements));
        }

        function openSettingsModal() {
            document.getElementById('settingsModal').classList.add('active');
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function openChangePasswordModal() {
            closeSettingsModal();
            document.getElementById('changePasswordModal').classList.add('active');
        }

        function closeChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.remove('active');
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            
            if (!current || !newPass || !confirm) {
                showInfoPopup('Missing Information', 'Please fill in all password fields!');
                return;
            }
            if (current !== userProfile.password) {
                showInfoPopup('Incorrect Password', 'Current password is incorrect!');
                return;
            }
            if (newPass !== confirm) {
                showInfoPopup('Password Mismatch', 'New passwords do not match!');
                return;
            }
            if (newPass.length < 6) {
                showInfoPopup('Password Too Short', 'Password must be at least 6 characters long!');
                return;
            }
            userProfile.password = newPass;
            addActivity('Changed password', '');
            saveData();
            closeChangePasswordModal();
            alert('Password changed successfully!');
        }

        function openAccountsModal() {
            closeSettingsModal();
            renderAccountsList();
            document.getElementById('accountsModal').classList.add('active');
        }

        function closeAccountsModal() {
            document.getElementById('accountsModal').classList.remove('active');
        }

        function renderAccountsList() {
            const container = document.getElementById('accountsList');
            const accountIds = Object.keys(accounts);
            container.innerHTML = accountIds.map(id => {
                const acc = accounts[id];
                const isActive = id === currentAccountId;
                const avatarHTML = acc.profile.avatar ? 
                    `<img src="${acc.profile.avatar}" alt="Avatar">` : '';
                return `
                    <div class="account-item ${isActive ? 'active' : ''}" onclick="switchAccount('${id}')">
                        <div class="account-avatar">${avatarHTML}</div>
                        <div class="account-info">
                            <div class="account-name">${acc.profile.name || 'Unnamed Account'}</div>
                            <div class="account-points">Level ${acc.level}  ${acc.points} points</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function switchAccount(accountId) {
            if (accountId === currentAccountId) return;
            currentAccountId = accountId;
            loadData();
            updateGreeting();
            updatePointsDisplay();
            updateLevelDisplay();
            updateProfilePage();
            renderPlants();
            updateNotificationBadge();
            renderNotifications();
            closeAccountsModal();
            saveData();
            alert('Account switched successfully!');
        }

        function openAuthModal() {
            closeAccountsModal();
            document.getElementById('authModal').classList.add('active');
            switchAuthTab('signin');
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
            document.getElementById('signinForm').reset();
            document.getElementById('signupForm').reset();
        }

        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            event.target.classList.add('active');
            if (tab === 'signin') {
                document.getElementById('signinForm').classList.add('active');
            } else {
                document.getElementById('signupForm').classList.add('active');
            }
        }

        function handleSignIn(event) {
            event.preventDefault();
            const username = document.getElementById('signinUsername').value;
            const password = document.getElementById('signinPassword').value;

            const accountId = Object.keys(accounts).find(id => {
                const acc = accounts[id];
                return acc.profile.username === username && acc.profile.password === password;
            });

            if (accountId) {
                currentAccountId = accountId;
                loadData();
                updateGreeting();
                updatePointsDisplay();
                updateLevelDisplay();
                updateProfilePage();
                renderPlants();
                updateNotificationBadge();
                renderNotifications();
                closeAuthModal();
                saveData();
                alert('Signed in successfully!');
            } else {
                showInfoPopup('Login Failed', 'Invalid username or password!');
            }
        }

        function handleSignUp(event) {
            event.preventDefault();
            const name = document.getElementById('signupName').value;
            const username = document.getElementById('signupUsername').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;

            const usernameExists = Object.values(accounts).some(acc => acc.profile.username === username);
            if (usernameExists) {
                showInfoPopup('Username Taken', 'Username already exists! Please choose a different username.');
                return;
            }

            if (password !== confirmPassword) {
                showInfoPopup('Password Mismatch', 'Passwords do not match!');
                return;
            }

            const accountCount = Object.keys(accounts).length;
            const newAccountId = `account_${accountCount + 1}`;
            
            accounts[newAccountId] = {
                profile: { 
                    name: name, 
                    bio: 'Plant enthusiast  | Growing green one plant at a time!', 
                    avatar: null, 
                    lastNameChange: Date.now(), 
                    password: password,
                    username: username
                },
                points: 0,
                level: 1,
                plants: [],
                tasks: JSON.parse(JSON.stringify(tasks)),
                redemptions: { pending: [], approved: [] },
                activity: [],
                missions: [],
                lastMissionReset: null,
                notifications: []
            };

            currentAccountId = newAccountId;
            loadData();
            updateGreeting();
            updatePointsDisplay();
            updateLevelDisplay();
            updateProfilePage();
            renderPlants();
            updateNotificationBadge();
            renderNotifications();
            closeAuthModal();
            saveData();
            alert('Account created successfully! Welcome to Leaf It Up!');
        }

        function openLogoutModal() {
            closeSettingsModal();
            document.getElementById('logoutModal').classList.add('active');
        }

        function closeLogoutModal() {
            document.getElementById('logoutModal').classList.remove('active');
        }

        function confirmLogout() {
            localStorage.clear();
            sessionStorage.clear();
            location.reload();
        }

        function checkNameSetup() {
            if (!userProfile.name || userProfile.name.trim() === '') {
                document.getElementById('nameSetupModal').classList.add('active');
            }
        }

        function saveInitialName() {
            const nameInput = document.getElementById('setupNameInput');
            const name = nameInput.value.trim();
            if (name === '') {
                showInfoPopup('Name Required', 'Please enter your name!');
                return;
            }
            userProfile.name = name;
            userProfile.lastNameChange = Date.now();
            leaderboardData[0].name = name;
            saveData();
            updateGreeting();
            updateProfilePage();
            document.getElementById('nameSetupModal').classList.remove('active');
        }

        function updateGreeting() {
            const greetingText = document.getElementById('greetingText');
            const greetingSubtext = document.getElementById('greetingSubtext');
            if (userProfile.name && userProfile.name.trim() !== '') {
                greetingText.textContent = `Hello ${userProfile.name}!`;
                greetingSubtext.textContent = 'Welcome to your plant tracking dashboard';
            } else {
                greetingText.textContent = 'Hello Planter!';
                greetingSubtext.innerHTML = 'Please <a onclick="showSection(\'profile\')">set your name in your profile</a> to personalize your experience';
            }
        }

        function openEditNameModal() {
            const modal = document.getElementById('editNameModal');
            const input = document.getElementById('editNameInput');
            const warning = document.getElementById('nameChangeWarning');
            const saveBtn = document.getElementById('saveNameBtn');
            input.value = userProfile.name;
            const canChange = !userProfile.lastNameChange || (Date.now() - userProfile.lastNameChange) >= 604800000;
            if (!canChange) {
                const nextChange = new Date(userProfile.lastNameChange + 604800000);
                document.getElementById('nextChangeDate').textContent = nextChange.toLocaleDateString();
                warning.style.display = 'block';
                saveBtn.disabled = true;
                saveBtn.style.opacity = '0.5';
                saveBtn.style.cursor = 'not-allowed';
            } else {
                warning.style.display = 'none';
                saveBtn.disabled = false;
                saveBtn.style.opacity = '1';
                saveBtn.style.cursor = 'pointer';
            }
            modal.classList.add('active');
        }

        function closeEditNameModal() {
            document.getElementById('editNameModal').classList.remove('active');
        }

        function saveNewName() {
            const input = document.getElementById('editNameInput');
            const newName = input.value.trim();
            if (newName === '') {
                showInfoPopup('Name Required', 'Please enter a name!');
                return;
            }
            const canChange = !userProfile.lastNameChange || (Date.now() - userProfile.lastNameChange) >= 604800000;
            if (!canChange) {
                showInfoPopup('Cannot Change Name', 'You can only change your name once per week!');
                return;
            }
            userProfile.name = newName;
            userProfile.lastNameChange = Date.now();
            leaderboardData[0].name = newName;
            saveData();
            updateGreeting();
            updateProfilePage();
            addActivity('Changed name', '');
            closeEditNameModal();
            alert('Name updated successfully!');
        }

        function showSection(sectionId) {
            document.querySelectorAll('.page-section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            
            if (sectionId === 'tips') sessionStorage.setItem('visitedTips', 'true');
            if (sectionId === 'community') sessionStorage.setItem('visitedCommunity', 'true');
            
            const sectionNames = {
                home: 'HOME', plants: 'MY PLANTS', tips: 'TIPS', leaderboard: 'LEADERBOARD',
                community: 'COMMUNITY', reward: 'REWARDS', profile: 'PROFILE', tasks: 'TASKS',
                notifications: 'NOTIFICATIONS'
            };
            
            document.querySelectorAll('.menu-item').forEach(item => {
                if (item.textContent.includes(sectionNames[sectionId])) item.classList.add('active');
            });

            if (sectionId === 'community') {
                updateCommunityStats();
                setTimeout(() => initCommunityMap(), 100);
            }
            if (sectionId === 'leaderboard') updateLeaderboard();
            if (sectionId === 'reward') renderRewards();
            if (sectionId === 'tasks') renderTasks();
            if (sectionId === 'profile') updateProfilePage();
            if (sectionId === 'notifications') {
                renderNotifications();
                notifications.forEach(n => n.unread = false);
                updateNotificationBadge();
                saveData();
            }
        }

        function toggleWeather() {
            const body = document.body;
            const btn = document.querySelector('.weather-toggle');
            if (weatherMode === 'night') {
                body.classList.remove('rainy-mode');
                body.classList.add('day-mode');
                btn.textContent = '';
                weatherMode = 'day';
            } else if (weatherMode === 'day') {
                body.classList.remove('day-mode');
                body.classList.add('rainy-mode');
                btn.textContent = '';
                weatherMode = 'rainy';
            } else {
                body.classList.remove('rainy-mode');
                btn.textContent = '';
                weatherMode = 'night';
            }
        }

        function openLogPlantModal() {
            document.getElementById('logPlantModal').classList.add('active');
            setTimeout(() => {
                if (!map) initMap();
                setMaxDate();
            }, 100);
        }

        function closeLogPlantModal() {
            document.getElementById('logPlantModal').classList.remove('active');
            document.getElementById('plantForm').reset();
            document.getElementById('imagePreview').innerHTML = '';
            document.getElementById('locationDisplay').textContent = 'Click on the map to select location';
            if (plantMarker && map) {
                map.removeLayer(plantMarker);
                plantMarker = null;
            }
            selectedLocation = null;
        }

        function openAvatarModal() {
            document.getElementById('avatarModal').classList.add('active');
        }

        function closeAvatarModal() {
            document.getElementById('avatarModal').classList.remove('active');
            document.getElementById('profileImagePreview').innerHTML = '';
        }

        function previewImage(event) {
            const preview = document.getElementById('imagePreview');
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            }
        }

        function previewAvatar(event) {
            const preview = document.getElementById('profileImagePreview');
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Avatar Preview" style="max-width: 200px; max-height: 200px; border-radius: 50%; border: 2px solid rgba(110, 255, 180, 0.3);">`;
                };
                reader.readAsDataURL(file);
            }
        }

        function saveAvatar() {
            const imageInput = document.getElementById('avatarImage');
            if (imageInput.files && imageInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    userProfile.avatar = e.target.result;
                    leaderboardData[0].avatar = e.target.result;
                    updateAvatarDisplay();
                    saveData();
                    closeAvatarModal();
                    addActivity('Updated profile photo', '');
                    alert('Profile photo updated successfully!');
                };
                reader.readAsDataURL(imageInput.files[0]);
            } else {
                showInfoPopup('No Image Selected', 'Please select an image first!');
            }
        }

        function updateAvatarDisplay() {
            const avatarHTML = userProfile.avatar ? `<img src="${userProfile.avatar}" alt="Avatar">` : '';
            document.getElementById('headerAvatar').innerHTML = avatarHTML;
            document.getElementById('profileAvatar').innerHTML = avatarHTML;
        }

        async function submitPlant(event) {
            event.preventDefault();
            if (!selectedLocation) {
                showInfoPopup('Location Required', 'Please select a location on the map!');
                return;
            }
            const locationName = await getLocationName(selectedLocation.lat, selectedLocation.lng);
            const plantData = {
                name: document.getElementById('plantName').value,
                type: document.getElementById('plantType').value,
                datePlanted: document.getElementById('datePlanted').value,
                lat: selectedLocation.lat,
                lng: selectedLocation.lng,
                locationName: locationName,
                watering: document.getElementById('wateringFreq').value,
                notes: document.getElementById('plantNotes').value,
                timestamp: new Date().toISOString(),
                wateringLog: []
            };

            const imageInput = document.getElementById('plantImage');
            if (imageInput.files && imageInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    plantData.image = e.target.result;
                    savePlant(plantData);
                };
                reader.readAsDataURL(imageInput.files[0]);
            } else {
                savePlant(plantData);
            }
        }

        function savePlant(plantData) {
            plants.push(plantData);
            addPoints(50);
            showPointsPopup(50);
            if (plants.length >= 5) {
                const task = tasks.find(t => t.id === 6);
                if (task && !task.completed) {
                    task.completed = true;
                    renderTasks();
                }
            }
            addActivity(`Logged plant: ${plantData.name}`, '');
            addNotification(' New Plant Added', `${plantData.name} has been added to your garden!`, 'plant', plantData.name, 'plants');
            saveData();
            renderPlants();
            closeLogPlantModal();
        }

        function addPoints(points) {
            const oldLevel = currentLevel;
            userPoints += points;
            leaderboardData[0].points = userPoints;
            currentLevel = Math.floor(userPoints / 500) + 1;
            updatePointsDisplay();
            updateLevelDisplay();
            saveData();
            if (currentLevel > oldLevel) {
                playLevelUpSound();
                showLevelUp(currentLevel);
                addNotification(' Level Up!', `Congratulations! You've reached Level ${currentLevel}!`, 'level', null, 'home');
            }
        }

        function updatePointsDisplay() {
            document.getElementById('pointsDisplay').textContent = userPoints;
            document.getElementById('rewardsPoints').textContent = userPoints;
        }

        function updateLevelDisplay() {
            document.getElementById('levelBadge').textContent = ` LEVEL ${currentLevel}`;
        }

        function showLevelUp(newLevel) {
            document.getElementById('newLevelNumber').textContent = newLevel;
            document.getElementById('levelUpNotification').classList.add('active');
            document.getElementById('levelUpOverlay').classList.add('active');
        }

        function closeLevelUp() {
            document.getElementById('levelUpNotification').classList.remove('active');
            document.getElementById('levelUpOverlay').classList.remove('active');
        }

        function toggleLevelProgress() {
            const modal = document.getElementById('levelProgressModal');
            modal.classList.add('active');
            updateLevelProgress();
        }

        function closeLevelProgress() {
            document.getElementById('levelProgressModal').classList.remove('active');
        }

        function updateLevelProgress() {
            const pointsInLevel = userPoints % 500;
            const progress = (pointsInLevel / 500) * 100;
            const nextLevelPoints = currentLevel * 500;
            document.getElementById('currentLevelDisplay').textContent = currentLevel;
            document.getElementById('currentPointsText').textContent = userPoints + ' PTS';
            document.getElementById('nextLevelText').textContent = nextLevelPoints + ' PTS';
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressBar').textContent = progress.toFixed(0) + '%';
        }

        function renderTasks() {
            const container = document.getElementById('tasksContainer');
            container.innerHTML = tasks.map(task => `
                <div class="task-card ${task.completed ? 'completed' : ''}">
                    <div class="task-header">
                        <div class="task-icon">${task.icon}</div>
                        <div class="task-info">
                            <div class="task-title">${task.title}</div>
                            <div class="task-points">+${task.points} Points</div>
                        </div>
                    </div>
                    <div class="task-description">${task.description}</div>
                    <div class="task-actions">
                        ${task.completed ? 
                            `<div class="task-status completed"> Completed</div>` :
                            `<button class="claim-btn" onclick="claimTask(${task.id})">Claim Points</button>`
                        }
                    </div>
                </div>
            `).join('');
        }

        function claimTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task || task.completed) return;
            
            if (taskId === 6 && plants.length < 5) {
                showInfoPopup('Cannot Claim Points', 'You need to log 5 plants first to claim this reward! Current plants logged: ' + plants.length);
                return;
            }
            
            task.completed = true;
            addPoints(task.points);
            showPointsPopup(task.points);
            addActivity(`Completed task: ${task.title}`, '');
            saveData();
            renderTasks();
        }

        function renderPlants() {
            const container = document.getElementById('plantsContainer');
            if (plants.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon"></div>
                        <h3>No plants logged yet!</h3>
                        <p>Start by logging your first plant to build your garden.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = plants.map((plant, index) => {
                const progress = calculatePlantProgress(plant);
                const age = calculatePlantAge(plant.datePlanted);
                const lastWatered = plant.wateringLog && plant.wateringLog.length > 0 ? 
                    new Date(plant.wateringLog[plant.wateringLog.length - 1]).toLocaleString() : 'Never';
                const canWater = canWaterToday(plant);
                
                return `
                    <div class="plant-card" onclick="togglePlantCard(this, ${index})">
                        ${plant.image ? 
                            `<img src="${plant.image}" alt="${plant.name}" class="plant-image">` : 
                            `<div class="no-image"></div>`
                        }
                        <h3>${plant.name}</h3>
                        <p class="plant-info"><strong>Type:</strong> ${plant.type}</p>
                        <p class="plant-info"> ${plant.locationName || 'Unknown Location'}</p>
                        <p class="plant-info"> Planted: ${plant.datePlanted}</p>
                        <div class="plant-age">
                            <p class="plant-age-text"> ${age}</p>
                        </div>
                        <div class="plant-progress">
                            <p class="progress-label">Plant Health: ${progress.toFixed(0)}%</p>
                            <div class="progress-bar-container">
                                <div class="progress-bar-fill" style="width: ${progress}%">${progress.toFixed(0)}%</div>
                            </div>
                        </div>
                        <p class="plant-info"> Watering: ${plant.watering}</p>
                        <div class="plant-actions">
                            <button class="water-btn" onclick="event.stopPropagation(); waterPlant(${index})" ${!canWater ? 'disabled' : ''}>
                                 ${canWater ? 'Water Plant' : 'Already Watered Today'}
                            </button>
                            <button class="update-picture-btn" onclick="event.stopPropagation(); openUpdatePlantPictureModal(${index})">
                                 Update Picture
                            </button>
                            <p class="last-watered">Last watered: ${lastWatered}</p>
                        </div>
                        ${plant.notes ? `<p class="plant-info"><strong>Notes:</strong> ${plant.notes}</p>` : ''}
                    </div>
                `;
            }).join('');
        }

        function togglePlantCard(element, plantIndex) {
            const allCards = document.querySelectorAll('.plant-card');
            if (element.classList.contains('expanded')) {
                element.classList.remove('expanded');
            } else {
                allCards.forEach(card => card.classList.remove('expanded'));
                element.classList.add('expanded');
            }
        }

        function updateCommunityStats() {
            const totalPlants = plants.length;
            const uniqueLocations = new Set(plants.map(p => `${p.lat},${p.lng}`)).size;
            document.getElementById('totalCommunityPlants').textContent = totalPlants;
            document.getElementById('totalLocations').textContent = uniqueLocations;
            document.getElementById('activePlanters').textContent = Object.keys(accounts).length;
            updateCommunityChart();
            updateRecentActivity();
        }

        function updateCommunityChart() {
            const ctx = document.getElementById('communityChart');
            if (communityChart) communityChart.destroy();

            const plantsByMonth = {};
            plants.forEach(plant => {
                const date = new Date(plant.datePlanted);
                const monthYear = date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                plantsByMonth[monthYear] = (plantsByMonth[monthYear] || 0) + 1;
            });

            const sortedMonths = Object.keys(plantsByMonth).sort((a, b) => new Date(a) - new Date(b));
            const labels = sortedMonths.length > 0 ? sortedMonths : ['No data'];
            const data = sortedMonths.length > 0 ? sortedMonths.map(m => plantsByMonth[m]) : [0];

            communityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Plants Logged',
                        data: data,
                        borderColor: '#6effb4',
                        backgroundColor: 'rgba(110, 255, 180, 0.2)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { labels: { color: '#c5f5d7' } } },
                    scales: {
                        y: { beginAtZero: true, ticks: { color: '#c5f5d7', stepSize: 1 }, grid: { color: 'rgba(197, 245, 215, 0.1)' } },
                        x: { ticks: { color: '#c5f5d7' }, grid: { color: 'rgba(197, 245, 215, 0.1)' } }
                    }
                }
            });
        }

        function updateRecentActivity() {
            const container = document.getElementById('recentActivity');
            if (plants.length === 0) {
                container.innerHTML = `
                    <div class="tip-card" style="text-align: center; color: #a8e6cf;">
                        <p>No recent activity yet. Start logging plants!</p>
                    </div>
                `;
                return;
            }

            const recentPlants = [...plants].reverse().slice(0, 5);
            container.innerHTML = recentPlants.map(plant => `
                <div class="tip-card">
                    <h3> ${plant.name}</h3>
                    <p><strong>Location:</strong> ${plant.locationName || 'Unknown'} | <strong>Date:</strong> ${plant.datePlanted} | <strong>Age:</strong> ${calculatePlantAge(plant.datePlanted)}</p>
                </div>
            `).join('');
        }

        function updateLeaderboard() {
            if (plants.length === 0) {
                document.getElementById('player1Name').textContent = '---';
                document.getElementById('player1Points').textContent = '0 PTS';
                document.getElementById('podium1Avatar').innerHTML = '<span></span>';
                document.getElementById('player2Name').textContent = '---';
                document.getElementById('player2Points').textContent = '0 PTS';
                document.getElementById('podium2Avatar').innerHTML = '<span></span>';
                document.getElementById('player3Name').textContent = '---';
                document.getElementById('player3Points').textContent = '0 PTS';
                document.getElementById('podium3Avatar').innerHTML = '<span></span>';
                document.getElementById('rankingsList').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon"></div>
                        <h3>No rankings yet!</h3>
                        <p>Start logging plants to compete on the leaderboard!</p>
                    </div>
                `;
                return;
            }

            const sortedData = [...leaderboardData].sort((a, b) => b.points - a.points);
            if (sortedData.length >= 1) {
                document.getElementById('player1Name').textContent = sortedData[0].name || 'Player 1';
                document.getElementById('player1Points').textContent = sortedData[0].points + ' PTS';
                const avatar1HTML = sortedData[0].avatar ? `<img src="${sortedData[0].avatar}" alt="Avatar">` : '<span></span>';
                document.getElementById('podium1Avatar').innerHTML = avatar1HTML;
            }
            if (sortedData.length >= 2) {
                document.getElementById('player2Name').textContent = sortedData[1].name || 'Player 2';
                document.getElementById('player2Points').textContent = sortedData[1].points + ' PTS';
                const avatar2HTML = sortedData[1].avatar ? `<img src="${sortedData[1].avatar}" alt="Avatar">` : '<span></span>';
                document.getElementById('podium2Avatar').innerHTML = avatar2HTML;
            } else {
                document.getElementById('player2Name').textContent = '---';
                document.getElementById('player2Points').textContent = '0 PTS';
                document.getElementById('podium2Avatar').innerHTML = '<span></span>';
            }
            if (sortedData.length >= 3) {
                document.getElementById('player3Name').textContent = sortedData[2].name || 'Player 3';
                document.getElementById('player3Points').textContent = sortedData[2].points + ' PTS';
                const avatar3HTML = sortedData[2].avatar ? `<img src="${sortedData[2].avatar}" alt="Avatar">` : '<span></span>';
                document.getElementById('podium3Avatar').innerHTML = avatar3HTML;
            } else {
                document.getElementById('player3Name').textContent = '---';
                document.getElementById('player3Points').textContent = '0 PTS';
                document.getElementById('podium3Avatar').innerHTML = '<span></span>';
            }

            const rankingsList = document.getElementById('rankingsList');
            if (sortedData.length <= 3) {
                rankingsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon"></div>
                        <h3>No additional rankings yet!</h3>
                        <p>More players will appear here as they join!</p>
                    </div>
                `;
                return;
            }

            const remainingRanks = sortedData.slice(3, 9);
            const colors = ['lime', 'orange', 'peach'];
            rankingsList.innerHTML = remainingRanks.map((player, index) => {
                const avatarHTML = player.avatar ? `<img src="${player.avatar}" alt="Avatar">` : `<span></span>`;
                return `
                    <div class="rank-row ${colors[index % 3]}">
                        <div class="rank-position">#${index + 4}</div>
                        <div class="rank-info">
                            <div class="rank-avatar small">${avatarHTML}</div>
                            <div class="rank-name">${player.name || 'Player ' + (index + 4)}</div>
                        </div>
                        <div class="rank-points">${player.points} PTS</div>
                    </div>
                `;
            }).join('');
        }

        function renderRewards() {
            const grid = document.getElementById('rewardsGrid');
            grid.innerHTML = rewardItems.map(item => `
                <div class="reward-item">
                    <div class="reward-image">${item.icon}</div>
                    <div class="reward-name">${item.name}</div>
                    <div class="reward-price">${item.price} PTS</div>
                    <button class="redeem-btn" onclick="redeemItem(${item.id})" ${userPoints < item.price ? 'disabled' : ''}>
                        ${userPoints < item.price ? 'Not Enough Points' : 'Redeem'}
                    </button>
                </div>
            `).join('');
        }

        function redeemItem(itemId) {
            const item = rewardItems.find(i => i.id === itemId);
            if (!item) return;
            if (userPoints >= item.price) {
                userPoints -= item.price;
                leaderboardData[0].points = userPoints;
                currentLevel = Math.floor(userPoints / 500) + 1;
                redemptionHistory.pending.push({
                    item: item.name,
                    points: item.price,
                    date: new Date().toLocaleDateString(),
                    status: 'pending'
                });
                playRedeemSound();
                addActivity(`Redeemed: ${item.name}`, '');
                addNotification(' Reward Redeemed', `You redeemed ${item.name} for ${item.price} points!`, 'reward', null, 'reward');
                updatePointsDisplay();
                updateLevelDisplay();
                saveData();
                renderRewards();
                renderRedemptionHistory();
                alert(` Successfully redeemed ${item.name} for ${item.price} points! Your request is pending approval.`);
            } else {
                showInfoPopup('Not Enough Points', `You need ${item.price - userPoints} more points to redeem this item!`);
            }
        }

        function switchHistoryTab(tab) {
            document.querySelectorAll('.history-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.history-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab + 'History').classList.add('active');
        }

        function renderRedemptionHistory() {
            const pendingContainer = document.getElementById('pendingHistory');
            const approvedContainer = document.getElementById('approvedHistory');
            if (redemptionHistory.pending.length === 0) {
                pendingContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon"></div>
                        <h3>No pending redemptions</h3>
                        <p>Your pending redemptions will appear here</p>
                    </div>
                `;
            } else {
                pendingContainer.innerHTML = redemptionHistory.pending.map(item => `
                    <div class="history-item pending">
                        <div class="history-info">
                            <div class="history-item-name">${item.item}</div>
                            <div class="history-item-details">${item.points} points  ${item.date}</div>
                        </div>
                        <div class="history-status pending"> Pending</div>
                    </div>
                `).join('');
            }

            if (redemptionHistory.approved.length === 0) {
                approvedContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon"></div>
                        <h3>No approved redemptions yet</h3>
                        <p>Your approved redemptions will appear here</p>
                    </div>
                `;
            } else {
                approvedContainer.innerHTML = redemptionHistory.approved.map(item => `
                    <div class="history-item approved">
                        <div class="history-info">
                            <div class="history-item-name">${item.item}</div>
                            <div class="history-item-details">${item.points} points  ${item.date}</div>
                        </div>
                        <div class="history-status approved"> Approved</div>
                    </div>
                `).join('');
            }
        }

        function updateProfilePage() {
            const displayName = userProfile.name || 'Planter';
            document.getElementById('profileDisplayName').textContent = displayName;
            document.getElementById('headerProfileName').textContent = displayName;
            document.getElementById('bioText').textContent = userProfile.bio;
            document.getElementById('profilePoints').textContent = userPoints;
            document.getElementById('profileLevel').textContent = currentLevel;
            document.getElementById('profilePlants').textContent = plants.length;
            updateAvatarDisplay();
            renderProfilePlants();
            renderActivityLog();
        }

        function editBio() {
            document.getElementById('bioDisplay').style.display = 'none';
            document.getElementById('bioEdit').style.display = 'block';
            document.getElementById('bioTextarea').value = userProfile.bio;
        }

        function saveBio() {
            const newBio = document.getElementById('bioTextarea').value;
            userProfile.bio = newBio;
            document.getElementById('bioText').textContent = newBio;
            document.getElementById('bioDisplay').style.display = 'block';
            document.getElementById('bioEdit').style.display = 'none';
            addActivity('Updated bio', '');
            saveData();
            alert('Bio updated successfully!');
        }

        function renderProfilePlants() {
            const container = document.getElementById('profilePlantsGrid');
            if (plants.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon"></div>
                        <h3>No plants logged yet!</h3>
                        <p>Start logging plants to see them here.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = plants.map((plant, index) => {
                const age = calculatePlantAge(plant.datePlanted);
                return `
                    <div class="plant-card" onclick="togglePlantCard(this, ${index})">
                        ${plant.image ? 
                            `<img src="${plant.image}" alt="${plant.name}" class="plant-image">` : 
                            `<div class="no-image"></div>`
                        }
                        <h3>${plant.name}</h3>
                        <p class="plant-info"><strong>Type:</strong> ${plant.type}</p>
                        <p class="plant-info"> ${plant.locationName || 'Unknown'}</p>
                        <p class="plant-info"> ${age}</p>
                    </div>
                `;
            }).join('');
        }

        function addActivity(action, icon) {
            const activity = {
                action: action,
                icon: icon,
                time: new Date().toLocaleString()
            };
            activityLog.unshift(activity);
            if (activityLog.length > 10) activityLog.pop();
            saveData();
        }

        function renderActivityLog() {
            const container = document.getElementById('profileLogHistory');
            if (activityLog.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon"></div>
                        <h3>No activity yet!</h3>
                        <p>Your activity history will appear here.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = activityLog.map(log => `
                <div class="log-history-item">
                    <div class="log-history-icon">${log.icon}</div>
                    <div class="log-history-details">
                        <div class="log-history-action">${log.action}</div>
                        <div class="log-history-time">${log.time}</div>
                    </div>
                </div>
            `).join('');
        }

        window.onload = function() {
            loadData();
            checkMissionReset();
            updatePointsDisplay();
            updateLevelDisplay();
            updateGreeting();
            renderPlants();
            renderRewards();
            renderRedemptionHistory();
            renderTasks();
            renderDailyMissions();
            renderAnnouncements();
            updateCommunityStats();
            updateLeaderboard();
            updateProfilePage();
            updateNotificationBadge();
            
            checkPlantWatering();
            checkAvailableRewards();
            checkLevelProgress();
            
            const firstCheckIn = sessionStorage.getItem('firstCheckIn');
            if (!firstCheckIn) {
                sessionStorage.setItem('firstCheckIn', 'true');
            }
            
            setTimeout(() => {
                checkNameSetup();
            }, 500);
            
            setInterval(() => {
                checkPlantWatering();
                checkAvailableRewards();
                checkLevelProgress();
            }, 300000);
        };
    </script>
</body>
</html>



